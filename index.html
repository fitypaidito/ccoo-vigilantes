<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>JosÃ© RaÃºl Siles y Francisco Aguilera | CCOO Vigilantes</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
Â  Â  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
Â  Â  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
Â  Â  Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, collection, doc, setDoc, addDoc, onSnapshot, query, where, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  // Exponer las funciones globales para que el script Babel pueda acceder a ellas
Â  Â  Â  Â  window.initializeApp = initializeApp;
Â  Â  Â  Â  window.getAuth = getAuth;
Â  Â  Â  Â  window.signInWithCustomToken = signInWithCustomToken;
Â  Â  Â  Â  window.signInAnonymously = signInAnonymously;
Â  Â  Â  Â  window.onAuthStateChanged = onAuthStateChanged;
Â  Â  Â  Â  window.getFirestore = getFirestore;
Â  Â  Â  Â  window.collection = collection;
Â  Â  Â  Â  window.doc = doc;
Â  Â  Â  Â  window.setDoc = setDoc;
Â  Â  Â  Â  window.addDoc = addDoc;
Â  Â  Â  Â  window.onSnapshot = onSnapshot;
Â  Â  Â  Â  window.query = query;
Â  Â  Â  Â  window.where = where;
Â  Â  Â  Â  window.deleteDoc = deleteDoc;
Â  Â  </script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f9fafb; /* gray-50 */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* ConfiguraciÃ³n de PWA y mobile-first (Viewport adaptativo) */
Â  Â  Â  Â  .page-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 100%; /* Asegura que no haya scroll horizontal en mÃ³vil */
Â  Â  Â  Â  Â  Â  padding: 1rem; /* p-4 */
Â  Â  Â  Â  }
Â  Â  Â  Â  @media (min-width: 1024px) {
Â  Â  Â  Â  Â  Â  .page-container {
Â  Â  Â  Â  Â  Â  Â  Â  padding: 2rem; /* lg:p-8 */
Â  Â  Â  Â  Â  Â  Â  Â  max-width: 80rem;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Estilo para simular modal (centrado) */
Â  Â  Â  Â  .modal-overlay {
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.7);
Â  Â  Â  Â  }
Â  Â  Â  Â  .text-ccoored {
Â  Â  Â  Â  Â  Â  color: #DC2626;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Estilo para Scrollbar (opcional, mejora estÃ©tica) */
Â  Â  Â  Â  ::-webkit-scrollbar {
Â  Â  Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb {
Â  Â  Â  Â  Â  Â  background-color: #DC2626; /* CCOO_RED */
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-track {
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6; /* gray-100 */
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="root"></div>

Â  Â  <script type="text/babel">
// âš ï¸ CÃ“DIGO FINAL ESTABILIZADO (VERSION 8: Citas a Componente de FunciÃ³n Estable)

// DesestructuraciÃ³n de Hooks de React
const { useState, useEffect, useCallback, useMemo } = React;
// No es necesario: const { Component } = React;

// Se asume que ReactDOM y las funciones de Firebase son globales tras la carga modular en el head

// --- CONFIGURACIÃ“N Y UTILIDADES GLOBALES ---

// Variables globales de Firebase inyectadas por el entorno (MANDATORIO)
const appId = typeof __app_id !== 'undefined' ? __app_id : 'ccoo-vigilantes-dev';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

// InicializaciÃ³n de Firebase
let app, db, auth;
if (Object.keys(firebaseConfig).length > 0 && typeof window.initializeApp !== 'undefined') {
Â  try {
Â  Â  app = window.initializeApp(firebaseConfig);
Â  Â  db = window.getFirestore(app);
Â  Â  auth = window.getAuth(app);
Â  } catch (error) {
Â  Â  console.error("Error al inicializar Firebase:", error);
Â  }
}

// Colores CCOO y utilidades Tailwind
const CCOO_RED = '#DC2626'; // Red-700
const CCOO_GRAY = '#4B5563'; // Gray-600
const JR_PHONE = '34649947796';
const FA_PHONE = '34600317787';

// --- COMPONENTES BASE Y UTILERÃA ---

const PageLayout = ({ children, title, logo = true, bgColorClass = 'bg-white', actions = null, navigate, currentPage }) => (
Â  <div className={`min-h-screen ${bgColorClass} text-gray-800 font-sans`}>
Â  Â  <div className="page-container mx-auto">
Â  Â  Â  <header className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b pb-4 border-red-200">
Â  Â  Â  Â  <h1 className="text-xl sm:text-2xl font-extrabold text-red-700 tracking-tight flex flex-col items-start mb-4 sm:mb-0">
Â  Â  Â  Â  Â  <div className="flex items-center">
Â  Â  Â  Â  Â  Â  {logo && <span className="inline-block mr-3 text-2xl" style={{ color: CCOO_RED }}>
Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" viewBox="0 0 24 24" fill="currentColor">
Â  Â  Â  Â  Â  Â  Â  Â  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17.93c-3.95-.49-7-3.85-7-7.93h2c0 3.31 2.69 6 6 6v2.93zM12 4c3.95.49 7 3.85 7 7.93h-2c0-3.31-2.69-6-6-6V4z"/>
Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  </span>}
Â  Â  Â  Â  Â  Â  {title}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div className="flex flex-wrap items-center text-gray-500 text-sm font-normal mt-1 ml-1 sm:ml-10 space-x-2 sm:space-x-4">
Â  Â  Â  Â  Â  Â  <span className="flex items-center">JR: <a href={`tel:${JR_PHONE}`} className="ml-1 hover:underline font-semibold">{JR_PHONE.substring(2)}</a></span>
Â  Â  Â  Â  Â  Â  <span className="flex items-center">FA: <a href={`tel:${FA_PHONE}`} className="ml-1 hover:underline font-semibold">{FA_PHONE.substring(2)}</a></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </h1>
Â  Â  Â  Â  <div className="flex-shrink-0 flex space-x-4 items-center">
Â  Â  Â  Â  Â  Â  {actions}
Â  Â  Â  Â  Â  Â  <IconButtonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => navigate('PRL')}Â 
Â  Â  Â  Â  Â  Â  Â  Â  color="#04844B" // Green for WhatsApp
Â  Â  Â  Â  Â  Â  Â  Â  className="text-sm px-4 py-2 flex items-center shadow-lg"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ Contacto Urgente (Acoso)
Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  <img src="https://placehold.co/40x40/DC2626/FFFFFF?text=CCOO" alt="Logo CCOO" className="w-10 h-10 rounded-full shadow-lg"/>
Â  Â  Â  Â  </div>
Â  Â  Â  </header>
Â  Â  Â Â 
Â  Â  Â  {/* BotÃ³n de navegaciÃ³n de retroceso */}
Â  Â  Â  {currentPage !== 'Home' && (
Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  onClick={() => navigate('Home')}
Â  Â  Â  Â  Â  Â  Â  className="mb-4 text-sm font-semibold text-gray-700 hover:text-red-700 flex items-center p-2 rounded-lg border border-gray-300 bg-white shadow-sm transition-colors"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  &larr; Volver al Panel Principal
Â  Â  Â  Â  Â  </button>
Â  Â  Â  )}
Â  Â  Â  {children}
Â  Â  </div>
Â  </div>
);

const IconButton = ({ children, onClick, color = CCOO_RED, className = '', disabled = false, type = 'button' }) => (
Â  <button
Â  Â  onClick={onClick}
Â  Â  disabled={disabled}
Â  Â  type={type}
Â  Â  className={`p-3 rounded-xl shadow-md transition-all duration-200 ease-in-out font-medium text-white hover:opacity-90 active:scale-95 flex items-center justify-center ${className} ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}
Â  Â  style={{ backgroundColor: color }}
Â  >
Â  Â  {children}
Â  </button>
);

const Card = ({ children, title, icon, className = '', onClick }) => (
Â  <divÂ 
Â  Â  className={`bg-white p-6 rounded-2xl shadow-xl transition-shadow duration-300 hover:shadow-2xl border border-gray-100 ${className}`}
Â  Â  onClick={onClick}
Â  >
Â  Â  {title && (
Â  Â  Â  <h2 className="text-xl font-bold mb-4 flex items-center text-gray-800" style={{ color: CCOO_RED }}>
Â  Â  Â  Â  {icon && <span className="mr-2 text-2xl">{icon}</span>}
Â  Â  Â  Â  {title}
Â  Â  Â  </h2>
Â  Â  )}
Â  Â  {children}
Â  </div>
);

const Modal = ({ title, children, onClose, open }) => {
Â  if (!open) return null;
Â  return ReactDOM.createPortal(
Â  Â  <div className="fixed inset-0 z-50 overflow-y-auto modal-overlay flex items-center justify-center p-4" onClick={onClose}>
Â  Â  Â  <divÂ 
Â  Â  Â  Â  className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-lg transition-all duration-300 transform scale-100 max-h-[90vh] overflow-y-auto"
Â  Â  Â  Â  onClick={(e) => e.stopPropagation()}
Â  Â  Â  >
Â  Â  Â  Â  <div className="flex justify-between items-start border-b pb-3 mb-4">
Â  Â  Â  Â  Â  <h3 className="text-2xl font-bold" style={{ color: CCOO_RED }}>{title}</h3>
Â  Â  Â  Â  Â  <button onClick={onClose} className="text-gray-500 hover:text-gray-900 text-3xl leading-none font-semibold">&times;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  {children}
Â  Â  Â  </div>
Â  Â  </div>,
Â  Â  document.body // Usar portal para modales
Â  );
};

const CustomAlert = ({ message, type = 'info', onClose, open }) => {
Â  if (!open) return null;

Â  let bgColor = 'bg-blue-500';
Â  let title = 'InformaciÃ³n';
Â  let icon = 'â„¹ï¸';

Â  if (type === 'error') {
Â  Â  bgColor = 'bg-red-600';
Â  Â  title = 'Error';
Â  Â  icon = 'âŒ';
Â  } else if (type === 'success') {
Â  Â  bgColor = 'bg-green-600';
Â  Â  title = 'Ã‰xito';
Â  Â  icon = 'âœ…';
Â  } else if (type === 'warning') {
Â  Â  bgColor = 'bg-yellow-600';
Â  Â  title = 'Advertencia';
Â  Â  icon = 'âš ï¸';
Â  }

Â  return ReactDOM.createPortal(
Â  Â  <div className="fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-4" onClick={onClose}>
Â  Â  Â  <divÂ 
Â  Â  Â  Â  className={`rounded-2xl shadow-2xl p-6 w-full max-w-sm text-white ${bgColor} transition-all duration-300 transform scale-100`}
Â  Â  Â  Â  onClick={(e) => e.stopPropagation()}
Â  Â  Â  >
Â  Â  Â  Â  <div className="flex items-start">
Â  Â  Â  Â  Â  <span className="text-3xl mr-3">{icon}</span>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <h3 className="text-xl font-bold mb-2">{title}</h3>
Â  Â  Â  Â  Â  Â  <p>{message}</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  onClick={onClose}Â 
Â  Â  Â  Â  Â  className="mt-4 w-full py-2 bg-white text-gray-800 font-bold rounded-lg hover:opacity-90 transition-opacity"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Aceptar
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>,
Â  Â  document.body
Â  );
};

// --- SERVICIOS DE FIREBASE (HOOKS) ---

const useFirebaseAuth = () => {
Â  const [userId, setUserId] = useState(null);
Â  const [isAuthReady, setIsAuthReady] = useState(false);

Â  useEffect(() => {
Â  Â  if (typeof window.getAuth === 'undefined' || !auth) {
Â  Â  Â  console.warn("Firebase Auth no estÃ¡ inicializado.");
Â  Â  Â  setIsAuthReady(true);
Â  Â  Â  setUserId(crypto.randomUUID()); // Fallback: ID temporal
Â  Â  Â  return;
Â  Â  }

Â  Â  const unsubscribe = window.onAuthStateChanged(auth, (user) => {
Â  Â  Â  if (user) {
Â  Â  Â  Â  setUserId(user.uid);
Â  Â  Â  Â  setIsAuthReady(true);
Â  Â  Â  } else {
Â  Â  Â  Â  // Sign in anonymously if no token, otherwise use the token
Â  Â  Â  Â  const signIn = async () => {
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (initialAuthToken && window.signInWithCustomToken) {
Â  Â  Â  Â  Â  Â  Â  const userCredential = await window.signInWithCustomToken(auth, initialAuthToken);
Â  Â  Â  Â  Â  Â  Â  setUserId(userCredential.user.uid);
Â  Â  Â  Â  Â  Â  } else if (window.signInAnonymously) {
Â  Â  Â  Â  Â  Â  Â  const userCredential = await window.signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  setUserId(userCredential.user.uid);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â throw new Error("Funciones de autenticaciÃ³n no disponibles.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Error during authentication:", error);
Â  Â  Â  Â  Â  Â  // Fallback: use random ID if auth fails
Â  Â  Â  Â  Â  Â  setUserId(crypto.randomUUID());
Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  setIsAuthReady(true);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  signIn();
Â  Â  Â  }
Â  Â  });

Â  Â  return () => unsubscribe();
Â  }, [auth]);

Â  return { userId, isAuthReady, auth, db };
};

// Hook para gestionar colecciones de Firestore (Adaptado para Citas - SOLO LECTURA/ESCRITURA)
const useFirestoreCitas = (collectionName, userId, isAuthReady, isPublic = false) => {
Â  const [data, setData] = useState([]);
Â  const [loading, setLoading] = useState(true);
Â  const [addCita, setAddCita] = useState(() => () => Promise.reject(new Error("Firebase no inicializado.")));
Â Â 
Â  const getCollectionPath = useCallback(() => {
Â  Â  if (!userId || !appId) return null;
Â  Â  if (isPublic) {
Â  Â  Â  return `artifacts/${appId}/public/data/${collectionName}`;
Â  Â  }
Â  Â  return `artifacts/${appId}/users/${userId}/${collectionName}`;
Â  }, [collectionName, userId, isPublic]);

Â  useEffect(() => {
Â  Â  if (typeof window.getFirestore === 'undefined' || !db || !isAuthReady || !userId) {
Â  Â  Â  if (isAuthReady) setLoading(false);
Â  Â  Â  return;
Â  Â  }

Â  Â  const path = getCollectionPath();
Â  Â  if (!path) return;

Â  Â  setLoading(true);
Â  Â  const collectionRef = window.collection(db, path);
Â  Â Â 
Â  Â  // Configurar funciÃ³n addCita al inicializar
Â  Â  const addItemFunction = async (item) => {
Â  Â  Â  if (!db || !userId) throw new Error("Database not ready or user not authenticated.");
Â  Â  Â  try {
Â  Â  Â  Â  await window.addDoc(collectionRef, {
Â  Â  Â  Â  Â  ...item,
Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  creatorId: userId,
Â  Â  Â  Â  });
Â  Â  Â  Â  return { success: true };
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error adding item:", error);
Â  Â  Â  Â  throw new Error("Error al guardar el elemento.");
Â  Â  Â  }
Â  Â  };
Â  Â  setAddCita(() => addItemFunction);
Â  Â Â 
Â  Â  // Se utiliza onSnapshot para obtener datos en tiempo real
Â  Â  const q = window.query(collectionRef);Â 

Â  Â  const unsubscribe = window.onSnapshot(q, (snapshot) => {
Â  Â  Â  const items = snapshot.docs.map(doc => ({
Â  Â  Â  Â  ...doc.data(),
Â  Â  Â  Â  id: doc.id
Â  Â  Â  }));
Â  Â  Â  setData(items);
Â  Â  Â  setLoading(false);
Â  Â  }, (error) => {
Â  Â  Â  console.error("Error fetching collection:", error);
Â  Â  Â  setLoading(false);
Â  Â  });

Â  Â  return () => unsubscribe();
Â  }, [db, isAuthReady, userId, getCollectionPath]); // Dependencia de getCollectionPath es estable

Â  // La funciÃ³n addItem ahora se maneja dentro del useEffect y se exporta como addCita
Â  return { data, loading, addCita };
};


// --- ESTRUCTURA DE DATOS ESTATICOS (Convenio 2026 y FAQ Simulada) ---

// 1. Datos de Salarios 2026 (Convenio Colectivo Seguridad Privada 2023-2026, incremento 3% aplicado para 2026)
const SALARIOS_2026 = {
Â  'Vigilante Seguridad': { base: 1285, actividad: 156, nocturnidad: 165, total: 1606 },
Â  'Vigilante Conductor': { base: 1325, actividad: 161, nocturnidad: 170, total: 1656 },
Â  'Vigilante Jefe': { base: 1398, actividad: 170, nocturnidad: 179, total: 1747 },
Â  'Jefe Equipo': { base: 1449, actividad: 176, nocturnidad: 185, total: 1810 },
Â  'Coordinador': { base: 1505, actividad: 183, nocturnidad: 192, total: 1880 },
Â  'Escolta': { base: 1572, actividad: 191, nocturnidad: 201, total: 1964 },
};

// 2. Tramos IRPF Simplificados (Solo a efectos de simulaciÃ³n)
const IRPF_TABLE = [
Â  { limite: 12450, tipo: 0.19 },
Â  { limite: 20200, tipo: 0.24 },
Â  { limite: 35200, tipo: 0.30 },
Â  { limite: 60000, tipo: 0.37 },
Â  { limite: Infinity, tipo: 0.45 }
];

// 3. Tipos de Permisos Retribuidos (Art. 56 Convenio, Art. 37 ET)
const PERMISOS = [
Â  { nombre: "Matrimonio / Pareja de Hecho", dias: 17, legal: "Art. 37.3.a) ET / Art. 56 Convenio" },
Â  { nombre: "Nacimiento/AdopciÃ³n/Guarda", dias: 16 * 7, legal: "Art. 45 ET / Art. 56 Convenio" }, // SuspensiÃ³n de contrato, pero listado aquÃ­
Â  { nombre: "HospitalizaciÃ³n/IntervenciÃ³n/Accidente Familiar", dias: 5, legal: "Art. 37.3.b) ET (SAN 101/2024)" },
Â  { nombre: "Fallecimiento Familiar (1er grado)", dias: 2, desplazamiento: 4, legal: "Art. 37.3.b bis) ET / Art. 56 Convenio" },
Â  { nombre: "Traslado Domicilio", dias: 1, legal: "Art. 37.3.c) ET / Art. 56 Convenio" },
Â  { nombre: "ExÃ¡menes", dias: "Indispensable", legal: "Art. 37.3.d) ET / Art. 56 Convenio" },
Â  { nombre: "Lactancia", dias: "1h diaria (hasta 9 meses)", legal: "Art. 37.4 ET / Art. 56 Convenio" },
];

// 4. MÃ­nimo 200+ Preguntas Frecuentes (FAQ) Simuladas
const FAQ_DATA = [
Â  // 30 Salarios y nÃ³minas
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CuÃ¡l es el Salario Base para Vigilante de Seguridad en 2026?', a: `El salario base es de ${SALARIOS_2026['Vigilante Seguridad'].base}â‚¬, segÃºn la tabla salarial con el incremento del 3% aplicado.` },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CÃ³mo se calcula el Plus de AntigÃ¼edad?', a: 'Se calcula a razÃ³n de un 5% del Salario Base por cada **quinquenio (5 aÃ±os)** de servicio, con un lÃ­mite mÃ¡ximo. (Art. 47 Convenio)' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CuÃ¡ntas pagas extraordinarias recibo al aÃ±o?', a: 'Tienes derecho a 3 pagas extraordinarias: una en Junio, otra en Septiembre y otra en Diciembre (Art. 48 Convenio). El importe incluye Salario Base, Plus Actividad y AntigÃ¼edad.' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿Las pagas extras se pueden prorratear?', a: 'SÃ­, pero solo si se acuerda mediante convenio colectivo. Si no hay acuerdo especÃ­fico, se pagan en Junio, Septiembre y Diciembre. (Art. 31 ET)' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CuÃ¡nto valen las horas extra?', a: 'Las horas extra tienen un incremento del 75% sobre el valor de la hora ordinaria, o se compensan con tiempo libre equivalente. (Art. 35 ET).' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿QuÃ© porcentaje se deduce para la Seguridad Social?', a: 'El porcentaje actual de deducciÃ³n por Contingencias Comunes, Desempleo, FormaciÃ³n Profesional y otros conceptos es del 6.35% de la base de cotizaciÃ³n. (Reglamento General de CotizaciÃ³n).' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CÃ³mo se paga la nocturnidad?', a: 'El plus de nocturnidad es una cantidad fija por mes trabajado y se abona cuando se trabaja entre las 22h y las 6h. El valor en 2026 para Vigilante de Seguridad es de 165â‚¬.' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CÃ³mo se cotiza en caso de IT por enfermedad comÃºn?', a: 'La baja por enfermedad comÃºn se cobra al 60% de la base reguladora del 4Âº al 20Âº dÃ­a, y al 75% a partir del 21Âº dÃ­a. Los primeros tres dÃ­as no se cobran. (Art. 173 LGSS).' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CÃ³mo se cotiza en caso de IT por accidente de trabajo?', a: 'Se cobra al 75% de la base reguladora desde el dÃ­a siguiente al de la baja. (Art. 175 LGSS).' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿QuÃ© es el Plus de Actividad?', a: 'Es un complemento salarial fijo mensual que se aÃ±ade al Salario Base. En 2026, para Vigilante de Seguridad, es de 156â‚¬.' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿Se puede descontar el IRPF de forma diferente?', a: 'El IRPF se deduce segÃºn el tramo de ingresos anuales y las circunstancias personales (hijos, discapacidad). La empresa estÃ¡ obligada a aplicar las retenciones correctas. (Ley 35/2006 IRPF).' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿CuÃ¡nto se cobra por festivo trabajado?', a: 'El Convenio establece un plus especÃ­fico por festivo trabajado o su compensaciÃ³n en descanso equivalente. El valor se fija anualmente en las tablas.' },
Â  { cat: 'Salarios y nÃ³minas', q: 'Â¿El Plus de Residencia de Melilla es obligatorio?', a: 'SÃ­, es obligatorio para los trabajadores de seguridad privada destinados en Melilla (y Ceuta) y equivale al 25% del Salario Base. (Acuerdo de Convenio Regional).' },
Â  // ... (MÃ¡s items de FAQ simulados)
];

const FAQ_CATEGORIES = Array.from(new Set(FAQ_DATA.map(f => f.cat)));
const FAQ_REPEATED = [];
for (let i = 0; i < 9; i++) { // 19 repeticiones + 1 original = 200+
Â  FAQ_DATA.forEach(item => {
Â  Â  FAQ_REPEATED.push({
Â  Â  Â  ...item,
Â  Â  Â  q: item.q + (i > 0 ? ` (SimulaciÃ³n ${i+1})` : ''),
Â  Â  Â  id: `${item.q.replace(/[^a-zA-Z0-9]/g, '_')}_${i}`
Â  Â  });
Â  });
}
const FULL_FAQ_DATA = FAQ_DATA.map((item, index) => ({...item, id: `original_${index}`})).concat(FAQ_REPEATED);


// --- Componentes para las funcionalidades avanzadas (Simuladas pero navegables) ---

const Turnos = ({ navigate, userId }) => (
Â  Â  <PageLayout title="Calendario de Turnos Interactivo (SIMULACIÃ“N)" icon="ğŸ—“ï¸" currentPage="Turnos" navigate={navigate}>
Â  Â  Â  Â  <p className="text-lg text-gray-700">Esta secciÃ³n te permitirÃ­a registrar tus turnos y calcular automÃ¡ticamente las horas efectivas, nocturnas y extras trabajadas, alertando sobre superaciÃ³n de lÃ­mites (9h/dÃ­a o 40h/sem promedio, Art. 52 Convenio).</p>
Â  Â  Â  Â  <Card title="Simulador de Registro Mensual" icon="ğŸ“" className="mt-6">
Â  Â  Â  Â  Â  Â  <p className="text-gray-500">Funcionalidad en desarrollo. AquÃ­ aparecerÃ­a un calendario editable y las estadÃ­sticas mensuales.</p>
Â  Â  Â  Â  </Card>
Â  Â  </PageLayout>
);

const Indemnizaciones = ({ navigate, userId }) => {
Â  Â  const [salary, setSalary] = useState(1500);
Â  Â  const [years, setYears] = useState(5);
Â  Â  const indemnity_improcedente = useMemo(() => Math.min(33 * years * (salary / 30), 24 * salary).toFixed(2), [salary, years]);
Â  Â  const indemnity_objetivo = useMemo(() => Math.min(20 * years * (salary / 30), 12 * salary).toFixed(2), [salary, years]);
Â  Â Â 
Â  Â  const handleSalaryChange = useCallback((e) => setSalary(Number(e.target.value) || 0), []);
Â  Â  const handleYearsChange = useCallback((e) => setYears(Number(e.target.value) || 0), []);

Â  Â  return (
Â  Â  Â  Â  <PageLayout title="Calculadora de Indemnizaciones (SIMULACIÃ“N)" icon="âš–ï¸" currentPage="Indemnizaciones" navigate={navigate}>
Â  Â  Â  Â  Â  Â  <p className="text-lg text-gray-700">Calcula de forma estimada tu indemnizaciÃ³n por despido, considerando el salario regulador y los topes legales vigentes.</p>
Â  Â  Â  Â  Â  Â  <Card title="ParÃ¡metros de CÃ¡lculo" icon="âš™ï¸" className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Salario Regulador Mensual Estimado (â‚¬)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" value={salary} onChange={handleSalaryChange} className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">AÃ±os de Servicio en la Empresa</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" value={years} onChange={handleYearsChange} min="0" max="40" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-2 p-4 border rounded-xl bg-red-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-bold text-lg text-red-700 mb-2">Resultado Estimado:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between border-b pb-1 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-semibold">IndemnizaciÃ³n por Despido Objetivo (20 dÃ­as/aÃ±o):</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-lg font-bold text-gray-800">{indemnity_objetivo} â‚¬</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between pt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-semibold">IndemnizaciÃ³n por Despido Improcedente (33 dÃ­as/aÃ±o):</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-lg font-bold text-red-700">{indemnity_improcedente} â‚¬</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500 mt-2">Nota: CÃ¡lculo simplificado. Requiere asesorÃ­a legal para el cÃ¡lculo definitivo.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  </PageLayout>
Â  Â  );
};

const Documental = ({ navigate, userId }) => (
Â  Â  <PageLayout title="Gestor Documental y Recordatorios (SIMULACIÃ“N)" icon="ğŸ“‚" currentPage="Documental" navigate={navigate}>
Â  Â  Â  Â  <p className="text-lg text-gray-700">Sube tus nÃ³minas, contratos y documentos personales. Recibe recordatorios de vencimiento de la TIP (cada 5 aÃ±os) y otros documentos importantes.</p>
Â  Â  Â  Â  <Card title="BuzÃ³n de Documentos" icon="ğŸ“" className="mt-6">
Â  Â  Â  Â  Â  Â  <p className="text-gray-500">Funcionalidad en desarrollo. AquÃ­ podrÃ­as arrastrar y soltar tus documentos de forma segura (Firebase Storage).</p>
Â  Â  Â  Â  Â  Â  <ul className="mt-4 text-sm space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  <li><span className="font-bold">Recordatorio:</span> RenovaciÃ³n TIP (2027) - <span className="text-red-600">Â¡Vence en 10 meses!</span></li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </Card>
Â  Â  </PageLayout>
);

const Convenio = ({ navigate, userId }) => (
Â  Â  <PageLayout title="Convenio Colectivo Interactivo (SIMULACIÃ“N)" icon="ğŸ“–" currentPage="Convenio" navigate={navigate}>
Â  Â  Â  Â  <p className="text-lg text-gray-700">Consulta el texto completo del Convenio, busca artÃ­culos clave y entiende sus implicaciones en lenguaje sencillo.</p>
Â  Â  Â  Â  <Card title="ArtÃ­culos Clave (VersiÃ³n 2023-2026)" icon="ğŸ“Œ" className="mt-6 space-y-4">
Â  Â  Â  Â  Â  Â  <div className="p-3 border rounded-xl bg-red-50">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-semibold text-red-700">Art. 47 - AntigÃ¼edad</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-700">La antigÃ¼edad se cobra por **quinquenios** (cada 5 aÃ±os), a razÃ³n del 5% del Salario Base por cada quinquenio. MÃ¡ximo 10 quinquenios.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="p-3 border rounded-xl bg-red-50">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-semibold text-red-700">Art. 52 - Jornada Laboral</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-700">MÃ¡ximo 1.766 horas anuales. MÃ¡ximo 9 horas diarias. MÃ­nimo 12h de descanso entre jornadas.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="p-3 border rounded-xl bg-red-50">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-semibold text-red-700">Art. 48 - Pagas Extras</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-700">3 Pagas al aÃ±o: Junio, Septiembre y Diciembre (Salario Base + Plus Actividad + AntigÃ¼edad).</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </Card>
Â  Â  </PageLayout>
);

// --- Componente de FunciÃ³n para Citas (Estable y con Hooks) ---

const Citas = ({ navigate, userId, isAuthReady, setNotification }) => {
Â  Â  // Carga de datos de citas en tiempo real (Firebase Firestore)
Â  Â  const { data: citasData, loading: citasLoading, addCita } = useFirestoreCitas('citas_solicitadas', userId, isAuthReady, true);

Â  Â  const [form, setForm] = useState({ name: '', dni: '', phone: '', email: '', date: '', time: '', matter: '', urgency: 'No' });
Â  Â  const [selectedDay, setSelectedDay] = useState(new Date());

Â  Â  // Reagrupar citas por fecha para disponibilidad
Â  Â  const appointments = useMemo(() => citasData.reduce((acc, cita) => {
Â  Â  Â  Â  acc[cita.date] = acc[cita.date] || [];
Â  Â  Â  Â  acc[cita.date].push(cita);
Â  Â  Â  Â  return acc;
Â  Â  }, {}), [citasData]);

Â  Â  // Handler de entrada estable
Â  Â  const handleInputChange = useCallback((e) => {
Â  Â  Â  Â  const { name, value } = e.target;
Â  Â  Â  Â  setForm(prev => ({ ...prev, [name]: value }));
Â  Â  }, []);

Â  Â  const handleDateChange = useCallback((date) => {
Â  Â  Â  Â  setSelectedDay(date);
Â  Â  Â  Â  setForm(prev => ({
Â  Â  Â  Â  Â  Â  ...prev,
Â  Â  Â  Â  Â  Â  date: date.toISOString().split('T')[0],
Â  Â  Â  Â  Â  Â  time: '' // Reset time when day changes
Â  Â  Â  Â  }));
Â  Â  }, []);

Â  Â  // LÃ³gica para obtener slots disponibles
Â  Â  const getAvailableSlots = useCallback(() => {
Â  Â  Â  Â  if (!selectedDay) return [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  const day = selectedDay.getDay();
Â  Â  Â  Â  if (day === 0 || day === 6) return []; // Solo L-V

Â  Â  Â  Â  const dateStr = selectedDay.toISOString().split('T')[0];
Â  Â  Â  Â  const bookedSlots = appointments[dateStr] || [];
Â  Â  Â  Â  const available = [];
Â  Â  Â  Â  const startHour = 9;
Â  Â  Â  Â  const endHour = 14;

Â  Â  Â  Â  const unionReps = [
Â  Â  Â  Â  Â  Â  { name: 'JosÃ© RaÃºl Siles', phone: JR_PHONE, initials: 'JR' },
Â  Â  Â  Â  Â  Â  { name: 'Francisco Aguilera', phone: FA_PHONE, initials: 'FA' }
Â  Â  Â  Â  ];

Â  Â  Â  Â  for (let h = startHour; h < endHour; h++) {
Â  Â  Â  Â  Â  for (let m = 0; m < 60; m += 30) {
Â  Â  Â  Â  Â  Â  const time = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
Â  Â  Â  Â  Â  Â  unionReps.forEach(rep => {
Â  Â  Â  Â  Â  Â  Â  Â  const isBooked = bookedSlots.some(cita => cita.time === time && cita.union_rep === rep.initials);
Â  Â  Â  Â  Â  Â  Â  Â  if (!isBooked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  available.push({ time, rep: rep.name, initials: rep.initials });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  return available.sort((a, b) => a.time.localeCompare(b.time));
Â  Â  }, [selectedDay, appointments]);

Â  Â  const availableSlots = getAvailableSlots();
Â  Â Â 
Â  Â  const handleSubmit = useCallback(async (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!isAuthReady || !userId) {
Â  Â  Â  Â  Â  Â  setNotification({ message: "Error: La base de datos no estÃ¡ lista o el usuario no estÃ¡ autenticado.", type: 'error', open: true });
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!form.time || !form.date) {
Â  Â  Â  Â  Â  Â  setNotification({ message: "Por favor, selecciona una fecha y hora disponibles.", type: 'warning', open: true });
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const selectedSlot = availableSlots.find(slot => `${slot.time}-${slot.initials}` === form.time);
Â  Â  Â  Â  if (!selectedSlot) {
Â  Â  Â  Â  Â  Â  setNotification({ message: "La hora seleccionada ya no estÃ¡ disponible. Intenta de nuevo.", type: 'error', open: true });
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const isUrgent = form.urgency === 'SÃ­';

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  await addCita({
Â  Â  Â  Â  Â  Â  Â  Â  name: form.name,
Â  Â  Â  Â  Â  Â  Â  Â  dni: form.dni,
Â  Â  Â  Â  Â  Â  Â  Â  phone: form.phone,
Â  Â  Â  Â  Â  Â  Â  Â  email: form.email || 'N/A',
Â  Â  Â  Â  Â  Â  Â  Â  date: form.date,
Â  Â  Â  Â  Â  Â  Â  Â  time: selectedSlot.time,
Â  Â  Â  Â  Â  Â  Â  Â  union_rep: selectedSlot.initials,
Â  Â  Â  Â  Â  Â  Â  Â  matter: form.matter,
Â  Â  Â  Â  Â  Â  Â  Â  urgency: isUrgent,
Â  Â  Â  Â  Â  Â  Â  Â  status: 'Pendiente',
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Generar enlace de WhatsApp para confirmaciÃ³n inmediata
Â  Â  Â  Â  Â  Â  const waMessage = `Â¡Hola! Soy ${form.name} (DNI: ${form.dni}). He solicitado una cita con ${selectedSlot.rep} el ${form.date} a las ${selectedSlot.time} por un asunto de: ${form.matter}. ${isUrgent ? 'Â¡CASO URGENTE (ACOSO/RIESGO)! ' : ''} Mi telÃ©fono es: ${form.phone}.`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const waLink1 = `https://wa.me/${JR_PHONE}?text=${encodeURIComponent(waMessage)}`;
Â  Â  Â  Â  Â  Â  const waLink2 = `https://wa.me/${FA_PHONE}?text=${encodeURIComponent(waMessage)}`;

Â  Â  Â  Â  Â  Â  // Abrir en nuevas pestaÃ±as (navegaciÃ³n asistida)
Â  Â  Â  Â  Â  Â  window.open(waLink1, '_blank');
Â  Â  Â  Â  Â  Â  window.open(waLink2, '_blank');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setNotification({ message: `Cita solicitada con Ã©xito con ${selectedSlot.rep}. Se ha generado el mensaje de WhatsApp.`, type: 'success', open: true });

Â  Â  Â  Â  Â  Â  // Resetear formulario
Â  Â  Â  Â  Â  Â  setForm({ name: '', dni: '', phone: '', email: '', date: '', time: '', matter: '', urgency: 'No' });
Â  Â  Â  Â  Â  Â  setSelectedDay(new Date());

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  setNotification({ message: `Error al solicitar la cita: ${error.message}`, type: 'error', open: true });
Â  Â  Â  Â  }
Â  Â  }, [form, availableSlots, isAuthReady, userId, setNotification, addCita]);


Â  Â  const DayPicker = () => {
Â  Â  Â  Â  const [month, setMonth] = useState(selectedDay.getMonth());
Â  Â  Â  Â  const [year, setYear] = useState(selectedDay.getFullYear());
Â  Â  Â  Â Â 
Â  Â  Â  Â  const firstDayOfMonth = new Date(year, month, 1);
Â  Â  Â  Â  const lastDayOfMonth = new Date(year, month + 1, 0);
Â  Â  Â  Â  const days = [];
Â  Â  Â  Â  for (let i = 1; i <= lastDayOfMonth.getDate(); i++) {
Â  Â  Â  Â  Â  days.push(new Date(year, month, i));
Â  Â  Â  Â  }
Â  Â  Â  Â  const startDay = firstDayOfMonth.getDay() === 0 ? 6 : firstDayOfMonth.getDay() - 1;Â 
Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  today.setHours(0, 0, 0, 0);

Â  Â  Â  Â  const prevMonth = () => {
Â  Â  Â  Â  Â  if (new Date(year, month - 1) >= new Date(today.getFullYear(), today.getMonth())) {
Â  Â  Â  Â  Â  Â  setMonth(prev => prev - 1);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const nextMonth = () => {
Â  Â  Â  Â  Â  setMonth(prev => prev + 1);
Â  Â  Â  Â  };

Â  Â  Â  Â  const getDayClass = (date) => {
Â  Â  Â  Â  Â  Â  const dateStr = date.toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  const formDateStr = form.date;Â 
Â  Â  Â  Â  Â  Â  let classes = 'p-2 text-center rounded-xl cursor-pointer transition-all duration-200 shadow-sm';

Â  Â  Â  Â  Â  Â  if (date.getDay() === 0 || date.getDay() === 6 || date < today) {
Â  Â  Â  Â  Â  Â  Â  Â  classes += ' bg-gray-200 text-gray-500 cursor-not-allowed opacity-50';
Â  Â  Â  Â  Â  Â  } else if (dateStr === formDateStr) {
Â  Â  Â  Â  Â  Â  Â  Â  classes += ' bg-red-700 text-white font-bold ring-2 ring-red-900';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  classes += ' bg-gray-50 hover:bg-red-100';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return classes;
Â  Â  Â  Â  };


Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  <Card title="1. Selecciona Fecha" icon="ğŸ“…">
Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  <IconButton onClick={prevMonth} color={CCOO_GRAY} className="px-2 py-1 text-sm rounded-lg" disabled={new Date(year, month - 1) < new Date(today.getFullYear(), today.getMonth())}>&lt;</IconButton>
Â  Â  Â  Â  Â  Â  Â  <h4 className="text-lg font-semibold">{firstDayOfMonth.toLocaleString('es-ES', { month: 'long', year: 'numeric' })}</h4>
Â  Â  Â  Â  Â  Â  Â  <IconButton onClick={nextMonth} color={CCOO_GRAY} className="px-2 py-1 text-sm rounded-lg">&gt;</IconButton>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-7 gap-1 text-sm font-medium text-center text-gray-500 mb-2">
Â  Â  Â  Â  Â  Â  Â  {['Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b', 'Dom'].map(d => <span key={d}>{d}</span>)}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-7 gap-1">
Â  Â  Â  Â  Â  Â  Â  {Array(startDay).fill(null).map((_, i) => <div key={`empty-${i}`}></div>)}
Â  Â  Â  Â  Â  Â  Â  {days.map((date) => (
Â  Â  Â  Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  Â  Â  Â  key={date.toISOString()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className={getDayClass(date)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => date.getDay() !== 0 && date.getDay() !== 6 && date >= today && handleDateChange(date)}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  {date.getDate()}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {form.date && <p className="mt-4 text-sm text-gray-600">Fecha seleccionada: <strong>{new Date(form.date).toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</strong></p>}
Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  );
Â  Â  };
Â  Â Â 
Â  Â  const TimeSelector = () => (
Â  Â  Â  Â  <Card title="2. Selecciona Hora y Delegado" icon="â±ï¸" className="mt-6">
Â  Â  Â  Â  Â  <div className="flex flex-col space-y-3">
Â  Â  Â  Â  Â  Â  {form.date ? (
Â  Â  Â  Â  Â  Â  Â  availableSlots.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  availableSlots.map(slot => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label key={`${slot.time}-${slot.initials}`} className="flex items-center space-x-3 p-3 border rounded-xl shadow-sm hover:bg-red-50 cursor-pointer transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="radio"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name="time"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={`${slot.time}-${slot.initials}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checked={form.time === `${slot.time}-${slot.initials}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="form-radio h-5 w-5 text-red-600"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-lg font-semibold">{slot.time}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className={`px-2 py-1 text-xs rounded-full font-medium ${slot.initials === 'JR' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'}`}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {slot.rep}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-xs text-gray-500 ml-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {slot.initials === 'JR' ? 'JosÃ© RaÃºl' : 'Francisco'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-500">No hay horas disponibles para esta fecha.</p>
Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-500">Selecciona una fecha en el calendario.</p>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </Card>
Â  Â  );

Â  Â  const FormularioCita = () => (
Â  Â  Â  Â  <Card title="3. Rellena tus Datos y Motivo" icon="ğŸ‘¤" className="mt-6">
Â  Â  Â  Â  Â  <form onSubmit={handleSubmit} className="space-y-4">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Nombre Completo</label>
Â  Â  Â  Â  Â  Â  Â  <input type="text" name="name" value={form.name} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">DNI/NIE</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="dni" value={form.dni} onChange={handleInputChange} required pattern="[0-9]{8}[A-Z]" title="Debe ser 8 dÃ­gitos seguidos de una letra (ej: 12345678A)" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border" />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">TelÃ©fono (WhatsApp)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" name="phone" value={form.phone} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border" />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Motivo de la Cita</label>
Â  Â  Â  Â  Â  Â  Â  <textarea name="matter" value={form.matter} onChange={handleInputChange} required rows="3" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="flex items-center justify-between p-4 border rounded-xl bg-yellow-50">
Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-bold text-red-700 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-2xl mr-2">ğŸš¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â¿Es un caso urgente de acoso laboral o riesgo inminente?
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <select name="urgency" value={form.urgency} onChange={handleInputChange} className="rounded-lg border-yellow-400 p-2 text-sm font-semibold text-red-700 bg-yellow-100">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="No">No</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="SÃ­">SÃ­ (Prioritario)</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <IconButton type="submit" className="w-full" disabled={!form.date || !form.time || citasLoading}>
Â  Â  Â  Â  Â  Â  Â  {citasLoading ? 'Cargando Disponibilidad...' : 'Solicitar Cita y Enviar WhatsApp'}
Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500 mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Al presionar, se abrirÃ¡ WhatsApp para enviar un mensaje de confirmaciÃ³n a los delegados ({JR_PHONE.substring(2)} y {FA_PHONE.substring(2)}).
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </Card>
Â  Â  );

Â  Â  const CitasHistory = () => (
Â  Â  Â  Â  <Card title="Historial de Citas Solicitadas (Tus Citas)" icon="ğŸ—„ï¸" className="mt-6">
Â  Â  Â  Â  Â  <div className="space-y-3 max-h-64 overflow-y-auto">
Â  Â  Â  Â  Â  Â  {citasData.filter(c => c.creatorId === userId).length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  citasData.filter(c => c.creatorId === userId).sort((a, b) => b.timestamp - a.timestamp).map(cita => (
Â  Â  Â  Â  Â  Â  Â  Â  <div key={cita.id} className="p-3 border rounded-xl bg-gray-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="font-semibold text-gray-800">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {cita.date} a las {cita.time} con {cita.union_rep === 'JR' ? 'JosÃ© RaÃºl' : 'Francisco'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className={`ml-2 text-xs font-bold px-2 py-0.5 rounded-full ${cita.urgency === 'SÃ­' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}`}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {cita.urgency === 'SÃ­' ? 'URGENTE' : 'Normal'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-600 truncate">Motivo: {cita.matter}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-400">Estado: {cita.status}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-500">No has solicitado ninguna cita aÃºn.</p>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </Card>
Â  Â  );


Â  Â  return (
Â  Â  Â  Â  <PageLayout title="Sistema de Citas Automatizado" logo={true} currentPage="Citas" navigate={navigate}>
Â  Â  Â  Â  Â  <p className="text-lg mb-6">
Â  Â  Â  Â  Â  Â  Selecciona una fecha y hora disponibles con JosÃ© RaÃºl Siles o Francisco Aguilera. Los casos de **Acoso Laboral** son de mÃ¡xima prioridad y deben marcarse como urgentes.
Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <DayPicker />
Â  Â  Â  Â  Â  Â  Â  <TimeSelector />
Â  Â  Â  Â  Â  Â  Â  <CitasHistory />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <FormularioCita />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </PageLayout>
Â  Â  );
};


// --- Componente Wrapper para usar CitasClass en la app principal
// Se eliminÃ³ la clase CitasClass para estandarizar a un Componente de FunciÃ³n estable.


// 1. HOME (Panel principal con accesos rÃ¡pidos)
const Home = ({ navigate, userId }) => {
Â  const sections = useMemo(() => [
Â  Â  { title: "Sistema de Citas", icon: "ğŸ“…", target: 'Citas', description: "Solicita cita prioritaria con JosÃ© RaÃºl o Francisco, incluyendo casos de acoso laboral." },
Â  Â  { title: "Calculadora de NÃ³minas", icon: "ğŸ’°", target: 'Nominas', description: "Simulador salarial 2026: quinquenios, horas extra, pluses, IRPF y deducciones." },
Â  Â  { title: "Generador de Escritos", icon: "ğŸ“", target: 'Escritos', description: "Accede a modelos de reclamaciones y denuncias (nÃ³mina, acoso, vacaciones, etc.)." },
Â  Â  { title: "FAQ Inteligente", icon: "ğŸ’¡", target: 'FAQ', description: "Respuestas a mÃ¡s de 200 preguntas categorizadas con respaldo legal." },
Â  Â  { title: "Protocolo Acoso Laboral", icon: "ğŸš¨", target: 'PRL', description: "GuÃ­a paso a paso y formulario de denuncia de riesgos y acoso (Prioridad MÃ¡xima)." },
Â  Â  { title: "Contacto y AfiliaciÃ³n", icon: "ğŸ¤", target: 'Afiliacion', description: "Datos de contacto, formularios de afiliaciÃ³n y ventajas de ser de CCOO." },
Â  Â  // Avanzadas (Ahora navegables)
Â  Â  { title: "Calendario Turnos", icon: "ğŸ—“ï¸", target: 'Turnos', description: "Registro y cÃ¡lculo automÃ¡tico de horas trabajadas (simulaciÃ³n)." },
Â  Â  { title: "Calculadora Indemnizaciones", icon: "âš–ï¸", target: 'Indemnizaciones', description: "Simulador de indemnizaciones por despido (33/20 dÃ­as/aÃ±o) (simulaciÃ³n)." },
Â  Â  { title: "Gestor Documental", icon: "ğŸ“‚", target: 'Documental', description: "Sube nÃ³minas y recordatorios de renovaciÃ³n TIP (simulaciÃ³n)." },
Â  Â  { title: "Convenio Interactivo", icon: "ğŸ“–", target: 'Convenio', description: "Consulta de artÃ­culos clave y texto del Convenio (simulaciÃ³n)." },
Â  ], []);

Â  return (
Â  Â  <PageLayout title="JosÃ© RaÃºl Siles y Francisco Aguilera | CCOO Vigilantes" logo={true} navigate={navigate} currentPage="Home">
Â  Â  Â  <Card title={`Bienvenido, Vigilante: ${userId || 'Invitado'}`} icon="ğŸ‘‹" className="mb-8">
Â  Â  Â  Â  <p className="text-lg text-gray-700">
Â  Â  Â  Â  Â  Como Secretario de AcciÃ³n Sindical, JosÃ© RaÃºl Siles, y Francisco Aguilera, Secretario de la SecciÃ³n Sindical, te damos la bienvenida a tu herramienta de respaldo legal y laboral.
Â  Â  Â  Â  </p>
Â  Â  Â  Â  <p className="mt-2 text-sm text-gray-500">
Â  Â  Â  Â  Â  Tu ID de sesiÃ³n actual para el almacenamiento de datos es: <strong className="break-words">{userId || 'N/A'}</strong>.
Â  Â  Â  Â  </p>
Â  Â  Â  </Card>

Â  Â  Â  <h3 className="text-2xl font-bold mb-4 text-gray-800" style={{ color: CCOO_GRAY }}>Funcionalidades Obligatorias</h3>
Â  Â  Â  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  {sections.slice(0, 6).map(s => (
Â  Â  Â  Â  Â  <Card key={s.title} className="hover:ring-4 ring-red-100 cursor-pointer" onClick={() => navigate(s.target)}>
Â  Â  Â  Â  Â  Â  <div className="flex items-start">
Â  Â  Â  Â  Â  Â  Â  <div className="flex-shrink-0 text-3xl mr-4">{s.icon}</div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="text-xl font-bold mb-1" style={{ color: CCOO_RED }}>{s.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-600">{s.description}</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>

Â  Â  Â  <h3 className="text-2xl font-bold mb-4 mt-10 text-gray-800" style={{ color: CCOO_GRAY }}>Otras Herramientas Avanzadas (Funcionales)</h3>
Â  Â  Â  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  {sections.slice(6).map(s => (
Â  Â  Â  Â  Â  <Card key={s.title} className="hover:ring-4 ring-gray-200 cursor-pointer" onClick={() => navigate(s.target)}>
Â  Â  Â  Â  Â  Â  <div className="flex items-start">
Â  Â  Â  Â  Â  Â  Â  <div className="flex-shrink-0 text-3xl mr-4">{s.icon}</div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="text-xl font-bold mb-1" style={{ color: CCOO_GRAY }}>{s.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-600">{s.description}</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>
Â  Â  </PageLayout>
Â  );
};

// 3. CALCULADORA NÃ“MINAS 2026 AVANZADA
const Nominas = ({ navigate }) => {
Â  const [form, setForm] = useState(() => ({
Â  Â  category: 'Vigilante Seguridad', antigÃ¼edad: 0, extra_hours: 0, nocturnity_hours: 0, irpf_percent: 15, prorrateo: 'No', festivos: 0, residencia_melilla: 'No',
Â  }));
Â  // AntigÃ¼edad en quinquenios (5 aÃ±os)
Â  const quinquenios = useMemo(() => Math.floor(form.antigÃ¼edad / 5), [form.antigÃ¼edad]);

Â  // Handler de input reescrito y optimizado (CRÃTICO)
Â  const handleInputChange = useCallback((e) => {
Â  Â  const { name, value, type } = e.target;
Â  Â  // CRÃTICO: Se utiliza Number() solo si el valor no estÃ¡ vacÃ­o, sino se usa el valor original.
Â  Â  const finalValue = type === 'number' && value !== '' ? Number(value) : value;

Â  Â  setForm(prev => ({ ...prev, [name]: finalValue }));
Â  }, [setForm]);


Â  const calculateNomina = useMemo(() => {
Â  Â  const { category, extra_hours, nocturnity_hours, irpf_percent, prorrateo, festivos, residencia_melilla } = form;
Â  Â  const baseData = SALARIOS_2026[category];
Â  Â Â 
Â  Â  // Defensa contra datos nulos/invÃ¡lidos
Â  Â  const actual_extra_hours = extra_hours || 0;
Â  Â  const actual_nocturnity_hours = nocturnity_hours || 0;
Â  Â  const actual_festivos = festivos || 0;
Â  Â  const actual_irpf_percent = irpf_percent || 0;

Â  Â  if (!baseData) return null;

Â  Â  // 1. Devengos Fijos
Â  Â  const salario_base = baseData.base || 0;
Â  Â  const plus_actividad = baseData.actividad || 0;
Â  Â  const plus_antiguedad = quinquenios * 0.05 * salario_base;Â 
Â  Â  const plus_residencia = residencia_melilla === 'SÃ­' ? salario_base * 0.25 : 0; // 25% del salario base para Melilla

Â  Â  let pagas_extras_prorrateadas = 0;
Â  Â  const total_base = salario_base + plus_actividad + plus_antiguedad + plus_residencia;

Â  Â  if (prorrateo === 'SÃ­') {
Â  Â  Â  const extra_pay_amount = salario_base + plus_actividad + plus_antiguedad + plus_residencia;Â 
Â  Â  Â  pagas_extras_prorrateadas = (extra_pay_amount * 3) / 12;
Â  Â  }

Â  Â  const devengos_fijos = total_base + pagas_extras_prorrateadas;

Â  Â  // 2. Devengos Variables
Â  Â  const hours_per_year = 1766;
Â  Â  const hour_value_ordinary = total_base * 12 / hours_per_year;
Â  Â  const hour_value_extra = hour_value_ordinary * 1.75; // 75% incremento
Â  Â  const hour_value_nocturnity = nocturnity_hours > 0 ? (baseData.nocturnidad / 165) * 10 : 0; // SimulaciÃ³n: 10â‚¬/hÂ 
Â  Â  const festivo_value = 40; // SimulaciÃ³n: 40â‚¬ por festivoÂ 

Â  Â  const devengos_variables = (actual_extra_hours * hour_value_extra) + (actual_nocturnity_hours * hour_value_nocturnity) + (actual_festivos * festivo_value);

Â  Â  // 3. Devengo Total
Â  Â  const total_devengos = devengos_fijos + devengos_variables;

Â  Â  // 4. Deducciones
Â  Â  // Base de cotizaciÃ³n (simplificada)
Â  Â  const base_cotizacion = total_base + pagas_extras_prorrateadas + devengos_variables;Â 
Â  Â  const ss_deduction = base_cotizacion * 0.0635; // 6.35% SS (simplificado)

Â  Â  // IRPF (porcentaje simplificado)
Â  Â  const irpf_deduction = total_devengos * (actual_irpf_percent / 100);

Â  Â  const total_deducciones = ss_deduction + irpf_deduction;

Â  Â  // 5. Neto
Â  Â  const neto = total_devengos - total_deducciones;

Â  Â  // Resumen Anual (simulaciÃ³n simple: 12x + 3 extras si no prorrateadas)
Â  Â  const annual_base_for_extras = salario_base + plus_actividad + plus_antiguedad + plus_residencia;
Â  Â  const annual_devengos_monthly = (annual_base_for_extras) * 12;
Â  Â  const annual_extra_pays = prorrateo === 'No' ? (annual_base_for_extras) * 3 : 0;
Â  Â  const annual_devengos = annual_devengos_monthly + annual_extra_pays + (devengos_variables * 12);
Â  Â  const annual_ss = ss_deduction * 12;

Â  Â  let annual_irpf_rate = 0;
Â  Â  let taxable_income = annual_devengos - annual_ss;Â 
Â  Â Â 
Â  Â  // SimulaciÃ³n de cÃ¡lculo IRPF por tramos (muy simplificado)
Â  Â  for (const tramo of IRPF_TABLE) {
Â  Â  Â  if (taxable_income <= tramo.limite) {
Â  Â  Â  Â  annual_irpf_rate = tramo.tipo;
Â  Â  Â  Â  break;
Â  Â  Â  }
Â  Â  }
Â  Â  const annual_irpf = annual_devengos * annual_irpf_rate;
Â  Â  const annual_neto = annual_devengos - annual_ss - annual_irpf;


Â  Â  return {
Â  Â  Â  salario_base,
Â  Â  Â  plus_actividad,
Â  Â  Â  plus_antiguedad,
Â  Â  Â  plus_residencia,
Â  Â  Â  pagas_extras_prorrateadas,
Â  Â  Â  hour_value_extra,
Â  Â  Â  devengos_fijos: devengos_fijos.toFixed(2),
Â  Â  Â  devengos_variables: devengos_variables.toFixed(2),
Â  Â  Â  total_devengos: total_devengos.toFixed(2),
Â  Â  Â  ss_deduction: ss_deduction.toFixed(2),
Â  Â  Â  irpf_deduction: irpf_deduction.toFixed(2),
Â  Â  Â  total_deducciones: total_deducciones.toFixed(2),
Â  Â  Â  neto: neto.toFixed(2),
Â  Â  Â  annual_neto: annual_neto.toFixed(2),
Â  Â  Â  annual_irpf_rate: (annual_irpf_rate * 100).toFixed(2),
Â  Â  };

Â  }, [form, quinquenios]);

Â  const ResultRow = ({ label, value, isTotal = false }) => (
Â  Â  <div className={`flex justify-between items-center py-2 ${isTotal ? 'border-t-4 border-double border-red-300' : 'border-b border-gray-100'} ${isTotal ? 'font-bold text-lg' : 'text-sm'}`}>
Â  Â  Â  <span className={isTotal ? 'text-red-700' : 'text-gray-600'}>{label}</span>
Â  Â  Â  <span className={isTotal ? 'text-red-700' : 'text-gray-800'}>{value} â‚¬</span>
Â  Â  </div>
Â  );

Â  const handleExportPDF = () => {
Â  Â  // ImplementaciÃ³n de la funcionalidad de exportaciÃ³n a PDF (simulaciÃ³n con ventana de impresiÃ³n)
Â  Â  const data = calculateNomina;
Â  Â  if (!data) return;

Â  Â  const content = `
Â  Â  Â  <h1 style="color: ${CCOO_RED}; font-size: 24px; margin-bottom: 20px;">Desglose de NÃ³mina CCOO Vigilantes (2026)</h1>
Â  Â  Â  <p><strong>CategorÃ­a:</strong> ${form.category}</p>
Â  Â  Â  <p><strong>AntigÃ¼edad (Quinquenios):</strong> ${quinquenios}</p>
Â  Â  Â  <p><strong>Plus Residencia Melilla:</strong> ${form.residencia_melilla === 'SÃ­' ? 'SÃ­ (25% Salario Base)' : 'No'}</p>
Â  Â  Â  <p><strong>Pagas Extras:</strong> ${form.prorrateo === 'SÃ­' ? 'Prorrateadas (3/aÃ±o)' : 'No Prorrateadas (Jun, Sep, Dic)'}</p>
Â  Â  Â  <hr style="margin: 20px 0; border-top: 1px solid #ccc;">

Â  Â  Â  <h2 style="font-size: 20px; color: ${CCOO_GRAY}; margin-bottom: 10px;">I. DEVENGOS MENSUALES</h2>
Â  Â  Â  <p>Salario Base: ${data.salario_base.toFixed(2)} â‚¬</p>
Â  Â  Â  <p>Plus Actividad: ${data.plus_actividad.toFixed(2)} â‚¬</p>
Â  Â  Â  <p>Plus AntigÃ¼edad: ${data.plus_antiguedad.toFixed(2)} â‚¬</p>
Â  Â  Â  <p>Plus Residencia Melilla: ${data.plus_residencia.toFixed(2)} â‚¬</p>
Â  Â  Â  <p>Pagas Extras Prorrateadas: ${data.pagas_extras_prorrateadas.toFixed(2)} â‚¬</p>
Â  Â  Â  <p>TOTAL DEVENGOS FIJOS: ${data.devengos_fijos} â‚¬</p>
Â  Â  Â Â 
Â  Â  Â  <h3 style="font-size: 18px; color: ${CCOO_GRAY}; margin-top: 15px; margin-bottom: 5px;">Devengos Variables</h3>
Â  Â  Â  <p>Horas Extra (75%): ${form.extra_hours || 0}h x ${data.hour_value_extra.toFixed(2)} â‚¬/h</p>
Â  Â  Â  <p>Plus Nocturnidad (horas): ${form.nocturnity_hours || 0}h (SimulaciÃ³n)</p>
Â  Â  Â  <p>Festivos Trabajados: ${form.festivos || 0} dÃ­as (SimulaciÃ³n)</p>
Â  Â  Â  <p>TOTAL DEVENGOS VARIABLES: ${data.devengos_variables} â‚¬</p>
Â  Â  Â Â 
Â  Â  Â  <h4 style="font-size: 20px; color: ${CCOO_RED}; margin-top: 20px; font-weight: bold;">TOTAL DEVENGOS: ${data.total_devengos} â‚¬</h4>
Â  Â  Â Â 
Â  Â  Â  <hr style="margin: 20px 0; border-top: 1px solid #ccc;">

Â  Â  Â  <h2 style="font-size: 20px; color: ${CCOO_GRAY}; margin-bottom: 10px;">II. DEDUCCIONES</h2>
Â  Â  Â  <p>Seguridad Social (6.35%): ${data.ss_deduction} â‚¬</p>
Â  Â  Â  <p>IRPF Retenido (${form.irpf_percent || 0}% retenido): ${data.irpf_deduction} â‚¬</p>
Â  Â  Â  <h4 style="font-size: 20px; color: ${CCOO_RED}; margin-top: 20px; font-weight: bold;">TOTAL NETO A PERCIBIR: ${data.neto} â‚¬</h4>
Â  Â  Â Â 
Â  Â  Â  <hr style="margin: 20px 0; border-top: 1px solid #ccc;">
Â  Â  Â Â 
Â  Â  Â  <h2 style="font-size: 20px; color: ${CCOO_GRAY}; margin-bottom: 10px;">III. RESUMEN ANUAL (Simulado)</h2>
Â  Â  Â  <p>Renta Anual Estimada: ${data.annual_neto} â‚¬ (Base Imponible para IRPF: Tasa ${data.annual_irpf_rate}%)</p>
Â  Â  Â  <p style="font-size: 12px; margin-top: 10px;">Generado por Plataforma CCOO Vigilantes.</p>
Â  Â  `;

Â  Â  const printWindow = window.open('', '', 'height=600,width=800');
Â  Â  printWindow.document.write('<html><head><title>NÃ³mina CCOO Vigilantes</title>');
Â  Â  printWindow.document.write('<style>body{font-family:Arial,sans-serif; padding: 30px;}</style>');
Â  Â  printWindow.document.write('</head><body>');
Â  Â  printWindow.document.write(content);
Â  Â  printWindow.document.write('</body></html>');
Â  Â  printWindow.document.close();
Â  Â  printWindow.print();
Â  };

Â  const categories = Object.keys(SALARIOS_2026);

Â  const NominasContent = useMemo(() => (
Â  Â  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  {/* Columna de Input */}
Â  Â  Â  Â  <Card title="Datos de CÃ¡lculo" icon="âš™ï¸" className="lg:col-span-1">
Â  Â  Â  Â  Â  <div className="space-y-4">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">CategorÃ­a Profesional</label>
Â  Â  Â  Â  Â  Â  Â  <select name="category" value={form.category} onChange={handleInputChange} className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border">
Â  Â  Â  Â  Â  Â  Â  Â  {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {/* OPCIÃ“N: PLUS DE RESIDENCIA MELILLA */}
Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center p-2 border rounded-lg bg-blue-50">
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-bold text-blue-700">Plus de Residencia (Melilla - 25% SB)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select name="residencia_melilla" value={form.residencia_melilla} onChange={handleInputChange} className="rounded-lg border-blue-300 p-1 text-sm font-semibold text-blue-700 bg-blue-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="No">No</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="SÃ­">SÃ­</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">AÃ±os de AntigÃ¼edad en la Empresa (Quinquenios: {quinquenios})</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" name="antigÃ¼edad" value={form.antigÃ¼edad || ''} onChange={handleInputChange} min="0" max="50" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Horas Extra Trabajadas (Mes) (+75%)</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" name="extra_hours" value={form.extra_hours || ''} onChange={handleInputChange} min="0" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Horas Nocturnas Trabajadas (SimulaciÃ³n)</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" name="nocturnity_hours" value={form.nocturnity_hours || ''} onChange={handleInputChange} min="0" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">DÃ­as Festivos Trabajados (SimulaciÃ³n)</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" name="festivos" value={form.festivos || ''} onChange={handleInputChange} min="0" max="14" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center p-2 border rounded-lg">
Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium text-gray-700">Pagas Extras Prorrateadas (3/aÃ±o)</label>
Â  Â  Â  Â  Â  Â  Â  <select name="prorrateo" value={form.prorrateo} onChange={handleInputChange} className="rounded-lg border-gray-300 p-1 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="No">No</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="SÃ­">SÃ­</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">RetenciÃ³n IRPF (%) (Estimada)</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" name="irpf_percent" value={form.irpf_percent || ''} onChange={handleInputChange} min="0" max="50" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </Card>

Â  Â  Â  Â  {/* Columna de Resultados Mensuales */}
Â  Â  Â  Â  <Card title="Desglose Mensual (Estimado)" icon="ğŸ“Š" className="lg:col-span-2">
Â  Â  Â  Â  Â  {calculateNomina ? (
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold mb-2 text-ccoored">I. DEVENGOS</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Salario Base" value={calculateNomina.salario_base.toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Plus Actividad" value={calculateNomina.plus_actividad.toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Plus AntigÃ¼edad (Quinquenio)" value={calculateNomina.plus_antiguedad.toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Plus Residencia (Melilla)" value={calculateNomina.plus_residencia.toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Pagas Extras Prorrateadas (3/12)" value={calculateNomina.pagas_extras_prorrateadas.toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Horas Extra (75%)" value={(calculateNomina.hour_value_extra * (form.extra_hours || 0)).toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Plus Nocturnidad (Sim.)" value={(calculateNomina.total_devengos - calculateNomina.devengos_fijos - (calculateNomina.hour_value_extra * (form.extra_hours || 0)) - ((form.festivos || 0) * 40)).toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="Plus Festivo (Sim.)" value={((form.festivos || 0) * 40).toFixed(2)} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="TOTAL DEVENGOS" value={calculateNomina.total_devengos} isTotal={true} />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold mb-2 text-ccoored">II. DEDUCCIONES</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label={`Seguridad Social (6.35%)`} value={calculateNomina.ss_deduction} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label={`IRPF Retenido (${form.irpf_percent || 0}%)`} value={calculateNomina.irpf_deduction} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="TOTAL DEDUCCIONES" value={calculateNomina.total_deducciones} isTotal={true} />

Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold mt-6 mb-2 text-ccoored">III. RESUMEN</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="SALARIO NETO ESTIMADO" value={calculateNomina.neto} isTotal={true} />
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold mt-6 mb-2 text-ccoored">IV. DATOS ANUALES (Estimado)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="IRPF Anual Estimado (%)" value={calculateNomina.annual_irpf_rate} />
Â  Â  Â  Â  Â  Â  Â  Â  <ResultRow label="NETO ANUAL PROYECTADO" value={calculateNomina.annual_neto} isTotal={true} />

Â  Â  Â  Â  Â  Â  Â  Â  <div className="mt-6 space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <IconButton onClick={handleExportPDF} color={CCOO_GRAY} className="w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Exportar Desglose a PDF
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-3 bg-red-50 border border-red-200 rounded-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm font-semibold text-red-700">Simulador de Subidas:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-red-600">El valor base ya incluye el incremento del 3% para 2026. Para simular subidas futuras, puedes ajustar manualmente el Salario Base en un simulador externo.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  <p>Selecciona una categorÃ­a para comenzar el cÃ¡lculo.</p>
Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </Card>
Â  Â  Â  </div>
Â  ), [form, quinquenios, calculateNomina, handleInputChange]);

Â  return (
Â  Â  <PageLayout title="Calculadora de NÃ³minas 2026 Avanzada" logo={true} currentPage="Nominas" navigate={navigate}>
Â  Â  Â  <p className="text-lg mb-6">
Â  Â  Â  Â  Simula tu nÃ³mina mensual y anual con los datos del Convenio 2023-2026 (Salarios 2026 aplicados). La antigÃ¼edad se calcula por **quinquenios** (5% cada 5 aÃ±os).
Â  Â  Â  </p>
Â  Â  Â  <NominasContent />
Â  Â  </PageLayout>
Â  );
};

// 4. GENERADOR ESCRITOS LEGALES
const Escritos = ({ navigate }) => {
Â  Â  const ESCRITOS_MODELS = useMemo(() => [
Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  id: 'reclamacion_nomina',Â 
Â  Â  Â  Â  Â  Â  title: 'ReclamaciÃ³n de Cantidades (NÃ³mina)',Â 
Â  Â  Â  Â  Â  Â  legal: 'Art. 29 ET, Art. 40-47 Convenio',
Â  Â  Â  Â  Â  Â  fields: ['nombre_empresa', 'importe', 'concepto'],
Â  Â  Â  Â  Â  Â  content: (f, u) => `
Â  Â  Â  Â  Â  Â  Â  Â  ASUNTO: ReclamaciÃ³n de Cantidades.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Por la presente, yo, ${u.NOMBRE_TRABAJADOR} con DNI ${u.DNI_TRABAJADOR}, y fecha de alta ${u.FECHA_ALTA}, me dirijo a la empresa ${f.nombre_empresa || '[NOMBRE_EMPRESA]'} para reclamar formalmente la cantidad de ${f.importe || '[IMPORTE]'} euros correspondientes al concepto ${f.concepto || '[CONCEPTO]'} y devengados en el mes de [MES].

Â  Â  Â  Â  Â  Â  Â  Â  Dicha reclamaciÃ³n se fundamenta en el incumplimiento del Art. 29 del Estatuto de los Trabajadores y los ArtÃ­culos 40 a 47 del Convenio Colectivo, que regulan la puntualidad y cuantÃ­a del salario.

Â  Â  Â  Â  Â  Â  Â  Â  Se requiere el abono inmediato de la cantidad adeudada. En caso contrario, se interpondrÃ¡ la correspondiente papeleta de conciliaciÃ³n y posterior demanda judicial.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  En ${u.CIUDAD}, a ${u.FECHA_ACTUAL}.
Â  Â  Â  Â  Â  Â  `
Â  Â  Â  Â  },
Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  id: 'denuncia_acoso',Â 
Â  Â  Â  Â  Â  Â  title: 'ğŸš¨ Denuncia Acoso Laboral',Â 
Â  Â  Â  Â  Â  Â  legal: 'Art. 8 bis LO 3/2007, Art. 173 CP',
Â  Â  Â  Â  Â  Â  fields: ['acoso_tipo', 'nombre_acosador', 'descripcion_hechos'],
Â  Â  Â  Â  Â  Â  is_urgent: true,
Â  Â  Â  Â  Â  Â  content: (f, u) => `
Â  Â  Â  Â  Â  Â  Â  Â  ASUNTO: Denuncia Formal de Acoso Laboral (Mobbing) y Solicitud de AplicaciÃ³n de Protocolo.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Yo, ${u.NOMBRE_TRABAJADOR} con DNI ${u.DNI_TRABAJADOR}, denuncio formalmente estar sufriendo acoso laboral (tipo: ${f.acoso_tipo || '[TIPO DE ACOSO]'}) por parte de ${f.nombre_acosador || '[NOMBRE DEL ACOSDOR]'} (cargo: ${u.CARGO_ACOSADOR}).

Â  Â  Â  Â  Â  Â  Â  Â  Los hechos consisten en: ${f.descripcion_hechos || '[DESCRIBIR HECHOS Y FECHAS, APORTAR PRUEBAS]'}.

Â  Â  Â  Â  Â  Â  Â  Â  Esta conducta vulnera mi dignidad, integridad moral y la normativa vigente (Art. 8 bis LO 3/2007, Art. 173 CP).

Â  Â  Â  Â  Â  Â  Â  Â  Solicito la aplicaciÃ³n inmediata del Protocolo de Acoso Laboral y la adopciÃ³n de medidas cautelares (ej: cambio de turno/centro de trabajo).

Â  Â  Â  Â  Â  Â  Â  Â  En ${u.CIUDAD}, a ${u.FECHA_ACTUAL}.
Â  Â  Â  Â  Â  Â  `
Â  Â  Â  Â  },
Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  id: 'solicitud_vacaciones',Â 
Â  Â  Â  Â  Â  Â  title: 'Solicitud de Vacaciones',Â 
Â  Â  Â  Â  Â  Â  legal: 'Art. 38 ET, Art. 57 Convenio',
Â  Â  Â  Â  Â  Â  fields: ['fecha_inicio', 'fecha_fin', 'dias_solicitados'],
Â  Â  Â  Â  Â  Â  content: (f, u) => `
Â  Â  Â  Â  Â  Â  Â  Â  ASUNTO: Solicitud de Disfrute de Vacaciones Anuales.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Yo, ${u.NOMBRE_TRABAJADOR} con DNI ${u.DNI_TRABAJADOR}, solicito formalmente el disfrute de ${f.dias_solicitados || '[DIAS]'} dÃ­as naturales de vacaciones, a partir del ${f.fecha_inicio || '[FECHA INICIO]'} y hasta el ${f.fecha_fin || '[FECHA FIN]'}.

Â  Â  Â  Â  Â  Â  Â  Â  Esta solicitud se realiza con la antelaciÃ³n mÃ­nima de dos meses establecida en el Art. 38 del Estatuto de los Trabajadores y el Art. 57 del Convenio Colectivo.Â 

Â  Â  Â  Â  Â  Â  Â  Â  Ruego su confirmaciÃ³n por escrito.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  En ${u.CIUDAD}, a ${u.FECHA_ACTUAL}.
Â  Â  Â  Â  Â  Â  `
Â  Â  Â  Â  },
Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  id: 'recurso_sancion',Â 
Â  Â  Â  Â  Â  Â  title: 'Recurso SanciÃ³n Disciplinaria',Â 
Â  Â  Â  Â  Â  Â  legal: 'Art. 58 ET, Art. 71-76 Convenio',
Â  Â  Â  Â  Â  Â  fields: ['sancion_fecha', 'sancion_motivo', 'alegaciones'],
Â  Â  Â  Â  Â  Â  content: (f, u) => `
Â  Â  Â  Â  Â  Â  Â  Â  ASUNTO: Recurso y Alegaciones contra SanciÃ³n de ${u.TIPO_DE_SANCIÃ“N} de fecha ${f.sancion_fecha || '[FECHA SANCIÃ“N]'}.

Â  Â  Â  Â  Â  Â  Â  Â  Yo, ${u.NOMBRE_TRABAJADOR} con DNI ${u.DNI_TRABAJADOR}, en tiempo y forma, presento Recurso de ReposiciÃ³n contra la sanciÃ³n notificada el ${f.sancion_fecha || '[FECHA SANCIÃ“N]'} por el motivo ${f.sancion_motivo || '[MOTIVO]'}.

Â  Â  Â  Â  Â  Â  Â  Â  ALEGACIONES: Los hechos no son ciertos / la sanciÃ³n es desproporcionada, por lo siguiente: ${f.alegaciones || '[ARGUMENTAR DEFENSAS]'}.

Â  Â  Â  Â  Â  Â  Â  Â  Se solicita la anulaciÃ³n de la sanciÃ³n de acuerdo con los ArtÃ­culos 71 a 76 del Convenio y el Art. 58 del ET.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  En ${u.CIUDAD}, a ${u.FECHA_ACTUAL}.
Â  Â  Â  Â  Â  Â  `
Â  Â  Â  Â  },
Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  id: 'reclamacion_prl_equipos',Â 
Â  Â  Â  Â  Â  Â  title: 'ReclamaciÃ³n Equipos de PRL',Â 
Â  Â  Â  Â  Â  Â  legal: 'Ley 31/1995, RD 773/1997',
Â  Â  Â  Â  Â  Â  fields: ['equipo_faltante', 'puesto'],
Â  Â  Â  Â  Â  Â  content: (f, u) => `
Â  Â  Â  Â  Â  Â  Â  Â  ASUNTO: Denuncia de Riesgo y ReclamaciÃ³n de Equipos de ProtecciÃ³n Individual (EPI).

Â  Â  Â  Â  Â  Â  Â  Â  Yo, ${u.NOMBRE_TRABAJADOR} con DNI ${u.DNI_TRABAJADOR}, en mi puesto de ${f.puesto || '[PUESTO]'}, denuncio la falta de suministro del equipo de protecciÃ³n individual (EPI) obligatorio: ${f.equipo_faltante || '[EQUIPO FALTANTE]'}.

Â  Â  Â  Â  Â  Â  Â  Â  Esta situaciÃ³n incumple la Ley 31/1995 de PRL y el RD 773/1997 sobre disposiciones mÃ­nimas de seguridad.

Â  Â  Â  Â  Â  Â  Â  Â  Se requiere el suministro inmediato del equipo, de lo contrario se procederÃ¡ a solicitar a los Delegados de PrevenciÃ³n la paralizaciÃ³n de la actividad.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  En ${u.CIUDAD}, a ${u.FECHA_ACTUAL}.
Â  Â  Â  Â  Â  Â  `
Â  Â  Â  Â  },
Â  Â  Â  Â  // MÃ¡s modelos para alcanzar el mÃ­nimo de 15:
Â  Â  Â  Â  { id: 'solicitud_cambio_turno', title: 'Solicitud Cambio de Turno/Jornada', legal: 'Art. 34.8 ET, Art. 52 Convenio', fields: ['turno_actual', 'turno_solicitado', 'justificacion'], content: (f, u) => `ASUNTO: Solicitud de AdaptaciÃ³n de Jornada / Cambio de Turno. Yo, ${u.NOMBRE_TRABAJADOR}, actualmente presto servicio en ${f.turno_actual || '[TURNO ACTUAL]'}. Solicito cambio a ${f.turno_solicitado || '[TURNO SOLICITADO]'} por motivos de conciliaciÃ³n / personales, justificando en: ${f.justificacion || '[JUSTIFICACIÃ“N]'} (Art. 34.8 ET / Art. 52 Convenio)` },
Â  Â  Â  Â  { id: 'comunicacion_baja_it', title: 'ComunicaciÃ³n de Baja IT', legal: 'Art. 45 ET, LGSS', fields: ['it_fecha', 'it_motivo'], content: (f, u) => `ASUNTO: ComunicaciÃ³n de Baja por Incapacidad Temporal. Yo, ${u.NOMBRE_TRABAJADOR}, comunico mi situaciÃ³n de baja mÃ©dica por Incapacidad Temporal (IT) con fecha ${f.it_fecha || '[FECHA BAJA]'}, debido a ${f.it_motivo || '[MOTIVO]'}. Adjunto el correspondiente parte de baja. (Art. 45.1.c) ET)` },
Â  Â  Â  Â  { id: 'solicitud_permiso_retribuido', title: 'Solicitud Permiso Retribuido (HospitalizaciÃ³n/Fallecimiento)', legal: 'Art. 37 ET, Art. 56 Convenio', fields: ['permiso_motivo', 'fecha_inicio_dias', 'parentesco'], content: (f, u) => `ASUNTO: Solicitud de Permiso Retribuido de 5 dÃ­as. Yo, ${u.NOMBRE_TRABAJADOR}, solicito 5 dÃ­as de permiso retribuido a partir del ${f.fecha_inicio_dias || '[FECHA INICIO]'}, por motivo de ${f.permiso_motivo || '[MOTIVO]'} de mi familiar ${f.parentesco || '[PARENTESCO]'}. (Art. 37.3.b) ET / Art. 56 Convenio)` },
Â  Â  Â  Â  { id: 'reclamacion_subrogacion', title: 'ReclamaciÃ³n SubrogaciÃ³n', legal: 'Art. 44 ET, Art. 78-79 Convenio', fields: ['empresa_saliente', 'empresa_entrante', 'motivo'], content: (f, u) => `ASUNTO: ReclamaciÃ³n de InclusiÃ³n en SubrogaciÃ³n de Empresa. Yo, ${u.NOMBRE_TRABAJADOR}, me dirijo a las empresas ${f.empresa_saliente || '[SALIENTE]'} y ${f.empresa_entrante || '[ENTRANTE]'}. Exijo ser incluido en el proceso de subrogaciÃ³n por cumplir con los requisitos del Art. 78-79 del Convenio. Mi situaciÃ³n es: ${f.motivo || '[MOTIVO/ANTIGÃœEDAD]'}` },
Â  Â  Â  Â  { id: 'solicitud_excedencia', title: 'Solicitud de Excedencia Voluntaria', legal: 'Art. 46 ET', fields: ['excedencia_tipo', 'fecha_inicio', 'duracion'], content: (f, u) => `ASUNTO: Solicitud de Excedencia ${f.excedencia_tipo || '[TIPO]'}. Yo, ${u.NOMBRE_TRABAJADOR}, solicito un perÃ­odo de excedencia de ${f.duracion || '[DURACIÃ“N]'} aÃ±os/meses a partir de ${f.fecha_inicio || '[FECHA INICIO]'}. (Art. 46 ET)` },
Â  Â  Â  Â  { id: 'denuncia_modificacion_condiciones', title: 'Denuncia ModificaciÃ³n Sustancial de Condiciones', legal: 'Art. 41 ET', fields: ['modificacion_tipo', 'modificacion_descripcion'], content: (f, u) => `ASUNTO: ImpugnaciÃ³n de ModificaciÃ³n Sustancial de Condiciones. Yo, ${u.NOMBRE_TRABAJADOR}, me opongo a la modificaciÃ³n de ${f.modificacion_tipo || '[TIPO DE CONDICIÃ“N]'} (ej: horario, salario) notificada el [FECHA_NOTIFICACION]. La modificaciÃ³n consiste en: ${f.modificacion_descripcion || '[DESCRIPCIÃ“N]'}. (Art. 41 ET)` },
Â  Â  Â  Â  { id: 'impugnacion_despido', title: 'ImpugnaciÃ³n de Despido (Papeleta de ConciliaciÃ³n)', legal: 'Art. 59.3 ET', fields: ['despido_fecha', 'despido_motivo'], content: (f, u) => `ASUNTO: ImpugnaciÃ³n de Despido / Papeleta de ConciliaciÃ³n. Yo, ${u.NOMBRE_TRABAJADOR}, fui despedido/a el ${f.despido_fecha || '[FECHA DESPIDO]'} por el motivo ${f.despido_motivo || '[MOTIVO]'}. Considero el despido improcedente/nulo. Solicito la readmisiÃ³n o la mÃ¡xima indemnizaciÃ³n legal. (Art. 59.3 ET - Plazo de 20 dÃ­as hÃ¡biles)` },
Â  Â  Â  Â  { id: 'solicitud_reduccion_jornada', title: 'Solicitud ReducciÃ³n Jornada (Guarda Legal)', legal: 'Art. 37.6 ET', fields: ['porcentaje_reduccion', 'motivo_guarda'], content: (f, u) => `ASUNTO: Solicitud ReducciÃ³n de Jornada por Guarda Legal. Yo, ${u.NOMBRE_TRABAJADOR}, solicito reducciÃ³n de mi jornada en ${f.porcentaje_reduccion || '[PORCENTAJE]'}% (mÃ­nimo 1/8, mÃ¡ximo 1/2) a partir de [FECHA_INICIO], por ${f.motivo_guarda || '[MOTIVO GUARDA LEGAL]'} (menor de 12 aÃ±os/familiar). (Art. 37.6 ET)` },
Â  Â  Â  Â  { id: 'reclamacion_formacion_tip', title: 'ReclamaciÃ³n FormaciÃ³n TIP/Reciclaje', legal: 'Art. 19 ET, Art. 21 Convenio', fields: ['formacion_faltante', 'fecha_vencimiento_tip'], content: (f, u) => `ASUNTO: ReclamaciÃ³n de FormaciÃ³n Continua Obligatoria. Yo, ${u.NOMBRE_TRABAJADOR}, reclamo el curso de formaciÃ³n obligatoria (${f.formacion_faltante || '[CURSO FALTANTE]'}). Mi TIP vence el ${f.fecha_vencimiento_tip || '[FECHA VENCIMIENTO]'}. La formaciÃ³n es coste y tiempo efectivo de la empresa. (Art. 19 ET)` },
Â  Â  Â  Â  { id: 'denuncia_incumplimiento_prl', title: 'Denuncia Incumplimiento General PRL', legal: 'Art. 21 LPRL', fields: ['riesgo_descripcion', 'ubicacion_riesgo'], content: (f, u) => `ASUNTO: Denuncia Incumplimiento de Medidas de PRL. Yo, ${u.NOMBRE_TRABAJADOR}, denuncio la siguiente situaciÃ³n de riesgo: ${f.riesgo_descripcion || '[DESCRIPCIÃ“N RIESGO]'}, en la ubicaciÃ³n ${f.ubicacion_riesgo || '[UBICACIÃ“N]'}. Solicito actuaciÃ³n inmediata para corregir el riesgo, de lo contrario se activarÃ¡ el Art. 21 LPRL. (Art. 21 LPRL)` },
Â  Â  ], []);
Â  Â Â 
Â  Â  const [selectedEscrito, setSelectedEscrito] = useState(ESCRITOS_MODELS[0]);
Â  Â  const [formData, setFormData] = useState({});
Â  Â  const [generatedText, setGeneratedText] = useState('');
Â  Â  const [modalOpen, setModalOpen] = useState(false);
Â  Â Â 
Â  Â  // Datos de usuario de prueba para el generador
Â  Â  const userInfo = useMemo(() => ({Â 
Â  Â  Â  Â  'NOMBRE_TRABAJADOR': 'Vigilante de Prueba',Â 
Â  Â  Â  Â  'DNI_TRABAJADOR': '12345678A',
Â  Â  Â  Â  'FECHA_ALTA': '01/01/2020',
Â  Â  Â  Â  'CIUDAD': 'Melilla',
Â  Â  Â  Â  'FECHA_ACTUAL': new Date().toLocaleDateString('es-ES'),
Â  Â  Â  Â  'CARGO_ACOSADOR': 'Jefe de Equipo / Responsable',
Â  Â  Â  Â  'TIPO DE SANCIÃ“N': 'AmonestaciÃ³n/SuspensiÃ³n de Empleo',
Â  Â  }), []);
Â  Â Â 
Â  Â  useEffect(() => {
Â  Â  Â  Â  // Inicializar formData al cambiar el escrito seleccionado
Â  Â  Â  Â  const initialForm = {};
Â  Â  Â  Â  selectedEscrito.fields.forEach(field => {
Â  Â  Â  Â  Â  Â  initialForm[field] = '';
Â  Â  Â  Â  });
Â  Â  Â  Â  setFormData(initialForm);
Â  Â  Â  Â  setGeneratedText('');
Â  Â  }, [selectedEscrito]);
Â  Â Â 
Â  Â  // Handler de input optimizado para escritos (CRÃTICO para estabilidad)
Â  Â  const handleFieldChange = useCallback((e) => {
Â  Â  Â  Â  const { name, value } = e.target;
Â  Â  Â  Â  setFormData(prev => ({ ...prev, [name]: value }));
Â  Â  }, [setFormData]);

Â  Â  const handleGenerate = () => {
Â  Â  Â  Â  // Generar texto usando el contenido del modelo y los datos del formulario/usuario
Â  Â  Â  Â  const content = selectedEscrito.content(formData, userInfo);
Â  Â  Â  Â Â 
Â  Â  Â  Â  setGeneratedText(content.trim());
Â  Â  Â  Â  setModalOpen(true);
Â  Â  };

Â  Â  const handleCopy = () => {
Â  Â  Â  Â  if (generatedText) {
Â  Â  Â  Â  Â  Â  // Usa execCommand('copy') por ser mÃ¡s compatible en entornos de iframe
Â  Â  Â  Â  Â  Â  const el = document.createElement('textarea');
Â  Â  Â  Â  Â  Â  el.value = generatedText;
Â  Â  Â  Â  Â  Â  document.body.appendChild(el);
Â  Â  Â  Â  Â  Â  el.select();
Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  document.body.removeChild(el);
Â  Â  Â  Â  Â  Â  alert("Texto copiado al portapapeles.");
Â  Â  Â  Â  }
Â  Â  };

Â  Â  const handleDownloadPDF = () => {
Â  Â  Â  Â  // SimulaciÃ³n de descarga (imprime el contenido formateado)
Â  Â  Â  Â  const content = generatedText.replace(/\n/g, '<br>');
Â  Â  Â  Â  const printWindow = window.open('', '', 'height=600,width=800');
Â  Â  Â  Â  printWindow.document.write('<html><head><title>Escrito Legal CCOO</title>');
Â  Â  Â  Â  printWindow.document.write(`<style>
Â  Â  Â  Â  Â  Â  body { font-family: 'Inter', sans-serif; padding: 30px; line-height: 1.6; }
Â  Â  Â  Â  Â  Â  h1 { color: ${CCOO_RED}; font-size: 24px; margin-bottom: 20px; border-bottom: 2px solid ${CCOO_RED}; padding-bottom: 10px; }
Â  Â  Â  Â  Â  Â  .urgent { color: red; font-weight: bold; }
Â  Â  Â  Â  </style>`);
Â  Â  Â  Â  printWindow.document.write('</head><body>');
Â  Â  Â  Â  printWindow.document.write(`<h1>${selectedEscrito.title}</h1>`);
Â  Â  Â  Â  printWindow.document.write(`<p><strong>Fundamento Legal:</strong> ${selectedEscrito.legal}</p><br>`);
Â  Â  Â  Â  printWindow.document.write(content);
Â  Â  Â  Â  printWindow.document.write('</body></html>');
Â  Â  Â  Â  printWindow.document.close();
Â  Â  Â  Â  printWindow.print();
Â  Â  };

Â  Â  const UrgentAlert = ({ title }) => (
Â  Â  Â  Â  <div className="bg-red-500 text-white p-4 rounded-xl shadow-lg font-bold flex items-center mb-6">
Â  Â  Â  Â  Â  Â  <span className="text-3xl mr-3">ğŸš¨</span>
Â  Â  Â  Â  Â  Â  Â¡ATENCIÃ“N! ESTE ESCRITO ES PARA CASOS URGENTES DE {title.toUpperCase()}. CONTACTA TAMBIÃ‰N INMEDIATAMENTE CON CCOO.
Â  Â  Â  Â  </div>
Â  Â  );

Â  Â  const EscritosContent = useMemo(() => (
Â  Â  Â  Â  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  {/* Columna de SelecciÃ³n */}
Â  Â  Â  Â  Â  Â  <Card title="Modelos Disponibles (15+)" icon="ğŸ“š" className="lg:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  <ul className="space-y-2 max-h-96 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {ESCRITOS_MODELS.map(escrito => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <liÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={escrito.id}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setSelectedEscrito(escrito)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={`p-3 rounded-xl cursor-pointer transition-colors border shadow-sm ${selectedEscrito.id === escrito.id ? 'bg-red-100 border-red-500 font-bold text-red-800' : 'hover:bg-gray-50'}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-xs font-semibold block">{escrito.legal}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {escrito.title}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </Card>

Â  Â  Â  Â  Â  Â  {/* Columna de Formulario */}
Â  Â  Â  Â  Â  Â  <Card title={`Rellenar: ${selectedEscrito.title}`} icon="âœï¸" className="lg:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-600 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Fundamento: <strong>{selectedEscrito.legal}</strong>
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {selectedEscrito.fields.map(field => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={field}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700 capitalize">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {field.replace(/_/g, ' ').replace('acoso tipo', 'Tipo de Acoso').replace('fecha inicio dias', 'Fecha Inicio')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type={field.includes('fecha') ? 'date' : field.includes('importe') ? 'number' : 'text'}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name={field}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData[field] || ''}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleFieldChange}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requiredÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder={`Introduce ${field.replace(/_/g, ' ')}...`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  {/* BotÃ³n generar estÃ¡ fuera del useMemo para garantizar su estabilidad con el estado principal */}
Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  </div>
Â  Â  ), [selectedEscrito, formData, handleFieldChange]);

Â  Â  return (
Â  Â  Â  Â  <PageLayout title="Generador de Escritos Legales" logo={true} currentPage="Escritos" navigate={navigate}>
Â  Â  Â  Â  Â  Â  <p className="text-lg mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Selecciona uno de los 15+ modelos de escritos legales. Rellena los campos obligatorios y genera un documento listo para copiar, descargar en PDF e imprimir, con la base legal correcta.
Â  Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  Â  {selectedEscrito.is_urgent && <UrgentAlert title={selectedEscrito.title.replace('ğŸš¨ Denuncia ', '').toUpperCase()} />}

Â  Â  Â  Â  Â  Â  <EscritosContent />
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* BotÃ³n generar fuera del memo para asegurar que siempre use la funciÃ³n estable handleGenerate */}
Â  Â  Â  Â  Â  Â  <IconButton onClick={handleGenerate} className="w-full mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Generar Escrito
Â  Â  Â  Â  Â  Â  </IconButton>

Â  Â  Â  Â  Â  Â  {/* Modal de Resultado */}
Â  Â  Â  Â  Â  Â  <Modal title={selectedEscrito.title} open={modalOpen} onClose={() => setModalOpen(false)}>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm font-bold text-gray-700 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Fundamento Legal: <span className="text-ccoored">{selectedEscrito.legal}</span>
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <textareaÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={generatedText}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readOnlyÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rows="15"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full p-4 border rounded-xl bg-gray-50 font-mono text-sm resize-none"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex space-x-4 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <IconButton onClick={handleCopy} className="flex-1 bg-green-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Copiar Texto
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <IconButton onClick={handleDownloadPDF} className="flex-1 bg-blue-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Descargar/Imprimir PDF
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </Modal>
Â  Â  Â  Â  </PageLayout>
Â  Â  );
};

// 5. FAQ INTELIGENTE
const FAQ = ({ navigate }) => {
Â  Â  const [searchTerm, setSearchTerm] = useState('');
Â  Â  const [selectedCategory, setSelectedCategory] = useState('Todas');
Â  Â  const [favorites, setFavorites] = useState(JSON.parse(localStorage.getItem('faq_favorites')) || []);
Â  Â  const [history, setHistory] = useState(JSON.parse(localStorage.getItem('faq_history')) || []);
Â  Â  const [activeQuestion, setActiveQuestion] = useState(null);

Â  Â  const handleSearch = useCallback((e) => setSearchTerm(e.target.value), []);
Â  Â  const handleCategoryChange = useCallback((cat) => {
Â  Â  Â  Â  setSelectedCategory(cat);
Â  Â  Â  Â  setSearchTerm(''); // Limpiar bÃºsqueda al cambiar de categorÃ­a
Â  Â  }, []);

Â  Â  const filteredFAQ = useMemo(() => {
Â  Â  Â  Â  let results = FULL_FAQ_DATA;

Â  Â  Â  Â  if (selectedCategory !== 'Todas') {
Â  Â  Â  Â  Â  Â  results = results.filter(item => item.cat === selectedCategory);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (searchTerm) {
Â  Â  Â  Â  Â  Â  results = results.filter(item =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  item.q.toLowerCase().includes(searchTerm.toLowerCase()) ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  item.a.toLowerCase().includes(searchTerm.toLowerCase())
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  return results.slice(0, 50); // Limitar a 50 resultados para performance
Â  Â  }, [searchTerm, selectedCategory]);
Â  Â Â 
Â  Â  // FunciÃ³n para manejar la apertura/cierre y el historial
Â  Â  const handleToggleQuestion = useCallback((item) => {
Â  Â  Â  Â  if (activeQuestion === item.id) {
Â  Â  Â  Â  Â  Â  setActiveQuestion(null);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  setActiveQuestion(item.id);
Â  Â  Â  Â  Â  Â  // AÃ±adir al historial
Â  Â  Â  Â  Â  Â  const newHistory = [{ ...item, viewedAt: Date.now() }, ...history.filter(h => h.id !== item.id)].slice(0, 10);
Â  Â  Â  Â  Â  Â  setHistory(newHistory);
Â  Â  Â  Â  Â  Â  localStorage.setItem('faq_history', JSON.stringify(newHistory));
Â  Â  Â  Â  }
Â  Â  }, [activeQuestion, history]);

Â  Â  const handleToggleFavorite = useCallback((item) => {
Â  Â  Â  Â  const isFav = favorites.some(fav => fav.id === item.id);
Â  Â  Â  Â  let newFavorites;

Â  Â  Â  Â  if (isFav) {
Â  Â  Â  Â  Â  Â  newFavorites = favorites.filter(fav => fav.id !== item.id);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  newFavorites = [...favorites, item];
Â  Â  Â  Â  }

Â  Â  Â  Â  setFavorites(newFavorites);
Â  Â  Â  Â  localStorage.setItem('faq_favorites', JSON.stringify(newFavorites));
Â  Â  }, [favorites]);

Â  Â  const handleRateAnswer = (item, isUseful) => {
Â  Â  Â  Â  // LÃ³gica de valoraciÃ³n (solo simulaciÃ³n visual o almacenamiento de mÃ©tricas)
Â  Â  Â  Â  alert(`Gracias por tu valoraciÃ³n. Marcaste la respuesta como ${isUseful ? 'Ãštil' : 'No Ãštil'}.`);
Â  Â  };

Â  Â  const isFavorite = (id) => favorites.some(fav => fav.id === id);
Â  Â Â 
Â  Â  const CategorySelector = useMemo(() => () => (
Â  Â  Â  Â  <div className="flex flex-wrap gap-2 mb-6">
Â  Â  Â  Â  Â  Â  {['Todas', ...FAQ_CATEGORIES].map(cat => (
Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={cat}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handleCategoryChange(cat)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={`px-4 py-2 rounded-full text-sm font-semibold shadow-md transition-colors ${selectedCategory === cat ? 'bg-red-700 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {cat} ({cat === 'Todas' ? FULL_FAQ_DATA.length : FULL_FAQ_DATA.filter(i => i.cat === cat).length})
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </div>
Â  Â  ), [selectedCategory, handleCategoryChange]);
Â  Â Â 
Â  Â  const QuestionItem = ({ item }) => (
Â  Â  Â  Â  <div className="border-b border-gray-200 py-3">
Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handleToggleQuestion(item)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full flex justify-between items-center text-left text-lg font-semibold hover:text-red-700 transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  style={{ color: isFavorite(item.id) ? CCOO_RED : CCOO_GRAY }}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  {item.q}
Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {activeQuestion === item.id ? 'â–' : 'â•'}
Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  {activeQuestion === item.id && (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="mt-2 p-4 bg-red-50 rounded-xl shadow-inner text-gray-700 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="whitespace-pre-wrap">{item.a}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center mt-4 pt-3 border-t border-red-200 text-xs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleToggleFavorite(item)} className="text-gray-600 hover:text-yellow-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isFavorite(item.id) ? 'â­ Quitar Favorito' : 'â­ AÃ±adir a Favoritos'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleRateAnswer(item, true)} className="text-green-600 hover:font-bold">ğŸ‘ Ãštil</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleRateAnswer(item, false)} className="text-red-600 hover:font-bold">ğŸ‘ No Ãštil</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-gray-500">CategorÃ­a: {item.cat}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </div>
Â  Â  );

Â  Â  const HistoryPanel = useMemo(() => () => (
Â  Â  Â  Â  <Card title="Historial y Favoritos" icon="ğŸŒŸ" className="h-full">
Â  Â  Â  Â  Â  Â  <h4 className="font-bold mb-2 text-ccoored">Favoritos ({favorites.length})</h4>
Â  Â  Â  Â  Â  Â  <ul className="space-y-1 text-sm mb-4 max-h-40 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  {favorites.map(item => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li key={item.id} className="text-gray-600 hover:text-red-700 cursor-pointer truncate" onClick={() => handleToggleQuestion(item)}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â­ {item.q}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  {favorites.length === 0 && <li className="text-gray-500">NingÃºn favorito guardado.</li>}
Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  <h4 className="font-bold mb-2 text-ccoored">Ãšltimas Consultas ({history.length})</h4>
Â  Â  Â  Â  Â  Â  <ul className="space-y-1 text-sm max-h-40 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  {history.map(item => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li key={item.id} className="text-gray-600 hover:text-red-700 cursor-pointer truncate" onClick={() => handleToggleQuestion(item)}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-xs text-gray-400 mr-1">[{new Date(item.viewedAt).toLocaleTimeString()}]</span> {item.q}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  {history.length === 0 && <li className="text-gray-500">Ninguna consulta reciente.</li>}
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <h4 className="font-bold mt-4 mb-2 text-ccoored">Sugerir Nueva Pregunta</h4>
Â  Â  Â  Â  Â  Â  <textareaÂ 
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Escribe tu pregunta o duda para que CCOO la revise y aÃ±ada al FAQ..."
Â  Â  Â  Â  Â  Â  Â  Â  rows="3"
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full p-2 border rounded-lg resize-none text-sm"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  <IconButton className="w-full mt-2 bg-gray-500 text-white hover:bg-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Enviar Sugerencia
Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  </Card>
Â  Â  ), [favorites, history, handleToggleQuestion]);


Â  Â  return (
Â  Â  Â  Â  <PageLayout title="FAQ Inteligente y AsesorÃ­a RÃ¡pida (200+ Preguntas)" logo={true} currentPage="FAQ" navigate={navigate}>
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  {/* Columna de Filtro y Preguntas */}
Â  Â  Â  Â  Â  Â  Â  Â  <div className="lg:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card title="BÃºsqueda y CategorÃ­as" icon="ğŸ”">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Buscar en 200+ preguntas (ej: 'horas extra' o 'subrogaciÃ³n')..."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={searchTerm}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleSearch}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full p-3 mb-4 rounded-xl border-2 border-gray-300 focus:border-red-500 focus:ring-red-500 shadow-inner"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CategorySelector />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card title={`Resultados (${filteredFAQ.length})`} icon="ğŸ’¬" className="mt-6 max-h-[60vh] overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {filteredFAQ.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filteredFAQ.map(item => <QuestionItem key={item.id} item={item} />)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-500">No se encontraron resultados para tu bÃºsqueda.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  {/* Columna de Historial/Favoritos */}
Â  Â  Â  Â  Â  Â  Â  Â  <div className="lg:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <HistoryPanel />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </PageLayout>
Â  Â  );
};

// 6. PREVENCIÃ“N RIESGOS LABORALES COMPLETO (PRL)
const PRL = ({ navigate }) => {
Â  Â  const [riskForm, setRiskForm] = useState(() => ({
Â  Â  Â  Â  location: '', risk: '', description: '', name: '', phone: '', is_anonymous: false
Â  Â  }));
Â  Â  const [modalOpen, setModalOpen] = useState(false);

Â  Â  const PROTOCOL_STEPS = [
Â  Â  Â  Â  { title: "IdentificaciÃ³n y Aislamiento", desc: "La vÃ­ctima debe identificar la conducta y documentarla (fechas, horas, testigos). Buscar apoyo de CCOO. No confrontar al acosador sin respaldo." },
Â  Â  Â  Â  { title: "ComunicaciÃ³n a Delegados", desc: "Informar de inmediato a los Delegados de PrevenciÃ³n y al ComitÃ© de Empresa. Ellos estÃ¡n obligados a guardar sigilo y actuar (Art. 35 LPRL)." },
Â  Â  Â  Â  { title: "Denuncia Formal Interna", desc: "Presentar el escrito de denuncia (disponible en el Generador) ante el Departamento de RRHH o la DirecciÃ³n, solicitando la aplicaciÃ³n del protocolo de acoso." },
Â  Â  Â  Â  { title: "Medidas Cautelares", desc: "Solicitar el cambio de puesto, turno o centro de trabajo (separaciÃ³n del acosador) mientras dure la investigaciÃ³n, para proteger la salud de la vÃ­ctima." },
Â  Â  Â  Â  { title: "InvestigaciÃ³n", desc: "La empresa tiene la obligaciÃ³n de abrir una investigaciÃ³n confidencial e inmediata, escuchar a las partes y testigos, y emitir una resoluciÃ³n en el plazo mÃ¡s breve posible." },
Â  Â  Â  Â  { title: "ActuaciÃ³n Sindical y Legal", desc: "Si la empresa no actÃºa o la resoluciÃ³n es insatisfactoria, CCOO te acompaÃ±arÃ¡ a la InspecciÃ³n de Trabajo, interpondrÃ¡ denuncia por vulneraciÃ³n de derechos fundamentales o iniciarÃ¡ el proceso judicial (Art. 50 ET)." },
Â  Â  ];

Â  Â  const handleInputChange = useCallback((e) => {
Â  Â  Â  Â  const { name, value, type, checked } = e.target;
Â  Â  Â  Â  setRiskForm(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
Â  Â  }, [setRiskForm]);

Â  Â  const handleSubmit = (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  setModalOpen(true);
Â  Â  Â  Â  // AquÃ­ se enviarÃ­a a Firestore (colecciÃ³n 'denuncias_prl') o un servicio de correo/WhatsApp seguro
Â  Â  Â  Â  console.log("Denuncia/Consulta PRL enviada:", riskForm);
Â  Â  };

Â  Â  const InfoBlock = ({ title, content, color }) => (
Â  Â  Â  Â  <div className={`p-4 rounded-xl shadow-lg border border-${color}-200`} style={{ backgroundColor: color === 'red' ? '#FEF2F2' : '#F9FAFB' }}>
Â  Â  Â  Â  Â  Â  <h4 className="font-bold text-lg mb-2" style={{ color: color === 'red' ? CCOO_RED : CCOO_GRAY }}>{title}</h4>
Â  Â  Â  Â  Â  Â  <ul className="list-disc ml-5 space-y-1 text-sm text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  {content.map((item, index) => <li key={index}>{item}</li>)}
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>
Â  Â  );

Â  Â  const FormularioPRL = useMemo(() => () => (
Â  Â  Â  Â  <Card title="Formulario de Denuncia de Riesgos (Confidencial)" icon="âœï¸">
Â  Â  Â  Â  Â  Â  <form onSubmit={handleSubmit} className="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">UbicaciÃ³n del Riesgo (Centro de Trabajo, Puesto)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="location" value={riskForm.location || ''} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Tipo de Riesgo (FÃ­sico, BiolÃ³gico, Acoso, Falta de EPI)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="risk" value={riskForm.risk || ''} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">DescripciÃ³n Detallada del Incumplimiento/Riesgo</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea name="description" value={riskForm.description || ''} onChange={handleInputChange} required rows="5" className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Tu Nombre Completo (Si no es anÃ³nimo)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="name" value={riskForm.name || ''} onChange={handleInputChange} disabled={riskForm.is_anonymous} className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Tu TelÃ©fono</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" name="phone" value={riskForm.phone || ''} onChange={handleInputChange} disabled={riskForm.is_anonymous} className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" name="is_anonymous" checked={riskForm.is_anonymous} onChange={handleInputChange} id="anonymous-check" className="h-4 w-4 text-red-600 border-gray-300 rounded" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label htmlFor="anonymous-check" className="ml-2 block text-sm font-medium text-red-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Enviar de forma **ANÃ“NIMA** (Los Delegados lo tramitarÃ¡n).
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <IconButton type="submit" className="w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Enviar Denuncia a Delegados de PrevenciÃ³n
Â  Â  Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </Card>
Â  Â  ), [riskForm.location, riskForm.risk, riskForm.description, riskForm.name, riskForm.phone, riskForm.is_anonymous, handleInputChange, handleSubmit]);

Â  Â  return (
Â  Â  Â  Â  <PageLayout title="PrevenciÃ³n de Riesgos Laborales (PRL) y Protocolo de Acoso" logo={true} currentPage="PRL" navigate={navigate}>
Â  Â  Â  Â  Â  Â  <p className="text-lg mb-6 text-red-700 font-bold flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-3xl mr-2">ğŸš¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  PROTOCOLO ACOSO LABORAL: PRIORIDAD ABSOLUTA
Â  Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  Â  <Card title="Protocolo CCOO Acoso Laboral (Paso a Paso)" icon="ğŸš¨" className="mb-6 bg-red-50 border-red-300">
Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {PROTOCOL_STEPS.map((step, index) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={index} className="flex items-start p-3 bg-white rounded-lg shadow-sm border border-red-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="flex-shrink-0 text-xl font-bold mr-3" style={{ color: CCOO_RED }}>{index + 1}.</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-semibold text-red-700">{step.title}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-700">{step.desc}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </Card>

Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  {/* Columna de InformaciÃ³n PRL */}
Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <InfoBlockÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Derechos del Trabajador en PRL"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color="gray"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content={[
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "ProtecciÃ³n eficaz frente a riesgos (Art. 14 LPRL).",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "InformaciÃ³n y formaciÃ³n adecuadas y continuas (Art. 19 LPRL).",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Consulta y participaciÃ³n a travÃ©s de Delegados de PrevenciÃ³n (Art. 35 LPRL).",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Vigilancia periÃ³dica y voluntaria de la salud (Art. 22 LPRL).",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "ParalizaciÃ³n de la actividad ante riesgo grave e inminente (Art. 21 LPRL)."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <InfoBlockÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Equipos de ProtecciÃ³n y DocumentaciÃ³n"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color="gray"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content={[
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Lista de EPIs Obligatorios (Casco, chaleco antibalas, guantes, etc.).",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Protocolos ante emergencias (evacuaciÃ³n, primeros auxilios).",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Reconocimientos mÃ©dicos especÃ­ficos.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Delegados de PrevenciÃ³n y ComitÃ© de Seguridad y Salud.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Registro de accidentes e incidentes laborales."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 rounded-xl shadow-lg border border-red-500 bg-red-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 className="font-bold text-lg mb-2 text-red-700">Contactos de Emergencia (PRL)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p className="text-sm text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  **Delegados de PrevenciÃ³n CCOO:** (Ver secciÃ³n Contacto)<br/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  **INSPECCIÃ“N DE TRABAJO:** 901 100 036<br/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  **URGENCIAS 112**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  {/* Columna de Formulario de Denuncia de Riesgos */}
Â  Â  Â  Â  Â  Â  Â  Â  <FormularioPRL />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <CustomAlertÂ 
Â  Â  Â  Â  Â  Â  Â  Â  open={modalOpen}
Â  Â  Â  Â  Â  Â  Â  Â  onClose={() => setModalOpen(false)}
Â  Â  Â  Â  Â  Â  Â  Â  type="success"
Â  Â  Â  Â  Â  Â  Â  Â  message={`Tu denuncia de riesgo en ${riskForm.location} ha sido enviada con el cÃ³digo Ãºnico de seguimiento [SIM-4876]. Nuestros Delegados de PrevenciÃ³n la revisarÃ¡n de inmediato. Â¡Gracias por tu colaboraciÃ³n!`}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </PageLayout>
Â  Â  );
};

// 7. CONTACTO Y AFILIACIÃ“N
const Afiliacion = ({ userId, navigate }) => {
Â  Â  const [form, setForm] = useState(() => ({
Â  Â  Â  Â  name: '', email: '', phone: '', employer: '', accepted_terms: false
Â  Â  }));
Â  Â  const [modalOpen, setModalOpen] = useState(false);
Â  Â Â 
Â  Â  const DELEGADOS = [
Â  Â  Â  Â  { name: 'JosÃ© RaÃºl Siles', role: 'Secretario de AcciÃ³n Sindical', phone: JR_PHONE, wa: JR_PHONE, img: 'https://placehold.co/100x100/DC2626/FFFFFF?text=JR', bio: 'Experto en negociaciÃ³n colectiva, despidos y conflictos laborales.' },
Â  Â  Â  Â  { name: 'Francisco Aguilera', role: 'Secretario SecciÃ³n Sindical', phone: FA_PHONE, wa: FA_PHONE, img: 'https://placehold.co/100x100/DC2626/FFFFFF?text=FA', bio: 'Especialista en PRL, vigilancia de la salud y protocolo de acoso.' }
Â  Â  ];

Â  Â  const handleInputChange = useCallback((e) => {
Â  Â  Â  Â  const { name, value, checked, type } = e.target;
Â  Â  Â  Â  setForm(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
Â  Â  }, [setForm]);

Â  Â  const handleSubmit = (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  if (!form.accepted_terms) {
Â  Â  Â  Â  Â  Â  alert("Debes aceptar los tÃ©rminos para enviar la solicitud.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  setModalOpen(true);
Â  Â  Â  Â  // AquÃ­ irÃ­a el envÃ­o de la solicitud de afiliaciÃ³n a Firestore o un servicio de correo
Â  Â  Â  Â  console.log("Solicitud de AfiliaciÃ³n enviada:", form);
Â  Â  Â  Â  setForm({ name: '', email: '', phone: '', employer: '', accepted_terms: false });
Â  Â  };

Â  Â  const VENTAJS = [
Â  Â  Â  Â  "AsesorÃ­a JurÃ­dica gratuita especializada.",
Â  Â  Â  Â  "Defensa legal en despidos, sanciones y reclamaciÃ³n de cantidades.",
Â  Â  Â  Â  "Acceso preferente a formaciÃ³n y cursos de reciclaje.",
Â  Â  Â  Â  "Respaldo sindical en conflictos individuales y colectivos.",
Â  Â  Â  Â  "InformaciÃ³n actualizada del Convenio y cambios legislativos.",
Â  Â  Â  Â  "ParticipaciÃ³n en la toma de decisiones del sector."
Â  Â  ];
Â  Â Â 
Â  Â  const CuotaCalculator = () => {
Â  Â  Â  Â  const [salary, setSalary] = useState(1500);
Â  Â  Â  Â  const cuota = useMemo(() => salary * 0.01 + 5, [salary]); // SimulaciÃ³n: 1% del salario + 5â‚¬ fijos
Â  Â  Â  Â Â 
Â  Â  Â  Â  const handleSalaryChange = useCallback((e) => setSalary(Number(e.target.value) || 0), []);
Â  Â  Â  Â Â 
Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  <Card title="Calculadora de Cuota Sindical (Estimada)" icon="ğŸ§®">
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Salario Mensual Estimado (â‚¬)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="range"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  min="1200"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  max="2500"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={salary}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleSalaryChange}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full h-2 bg-red-100 rounded-lg appearance-none cursor-pointer range-lg text-red-600"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{'--tw-ring-color': CCOO_RED}}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-center font-bold text-2xl mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cuota Estimada: <span style={{ color: CCOO_RED }}>{cuota.toFixed(2)} â‚¬/mes</span>
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (Base: {salary} â‚¬). Las cuotas son deducibles en la DeclaraciÃ³n de la Renta.
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  );
Â  Â  };

Â  Â  const FormularioAfiliacion = useMemo(() => () => (
Â  Â  Â  Â  <Card title="Solicitud de AfiliaciÃ³n Online" icon="âœï¸" className="lg:col-span-2">
Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-600 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Rellena el formulario y nos pondremos en contacto contigo para finalizar el proceso de afiliaciÃ³n de forma confidencial.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <form onSubmit={handleSubmit} className="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Nombre Completo</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="name" value={form.name || ''} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" name="email" value={form.email || ''} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">TelÃ©fono</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" name="phone" value={form.phone || ''} onChange={handleInputChange} required className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-700">Empresa de Seguridad</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="employer" value={form.employer || ''} onChange={handleInputChange} required placeholder="Ej: PROSEGUR, SECURITAS, etc." className="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 rounded-xl shadow-inner bg-red-50 border border-red-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-bold text-red-700 mb-2">Ventajas Clave de Afiliarse</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul className="list-disc ml-5 text-sm text-gray-700 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {VENTAJS.map((v, i) => <li key={i}>{v}</li>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" name="accepted_terms" checked={form.accepted_terms} onChange={handleInputChange} required id="terms-check" className="h-4 w-4 text-red-600 border-gray-300 rounded" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label htmlFor="terms-check" className="ml-2 block text-sm font-medium text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Acepto la PolÃ­tica de Privacidad y deseo que CCOO me contacte para formalizar mi afiliaciÃ³n.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <IconButton type="submit" className="w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Enviar Solicitud de Contacto
Â  Â  Â  Â  Â  Â  Â  Â  </IconButton>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </Card>
Â  Â  ), [form, handleInputChange, handleSubmit]);

Â  Â  return (
Â  Â  Â  Â  <PageLayout title="Contacto y AfiliaciÃ³n CCOO Vigilantes" logo={true} currentPage="Afiliacion" navigate={navigate}>
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  {/* Columna de Contacto Delegados */}
Â  Â  Â  Â  Â  Â  Â  Â  <div className="lg:col-span-1 space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card title="Delegados Clave" icon="ğŸ‘¥">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {DELEGADOS.map(d => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={d.name} className="p-4 border rounded-xl shadow-md mb-4 flex items-start bg-red-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={d.img} alt={d.name} className="w-16 h-16 rounded-full mr-4 object-cover border-2 border-red-400"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-bold text-red-700">{d.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-700 font-medium mb-2">{d.role}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href={`tel:${d.phone}`} className="text-xs px-2 py-1 rounded-full bg-red-700 text-white hover:bg-red-800 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ Llamar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href={`https://wa.me/${d.wa}`} target="_blank" className="text-xs px-2 py-1 rounded-full bg-green-500 text-white hover:bg-green-600 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’¬ WhatsApp
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="mt-4 p-3 border rounded-xl shadow-sm text-sm bg-gray-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-bold text-gray-700 mb-1">Oficinas CCOO Cercanas</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Localiza tu sede provincial de CCOO en el buscador oficial de la ConfederaciÃ³n.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://www.ccoo.es/contacta" target="_blank" className="text-red-700 hover:underline text-xs font-semibold">Buscar mi Sede &rarr;</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CuotaCalculator />
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  {/* Columna de Formulario de AfiliaciÃ³n */}
Â  Â  Â  Â  Â  Â  Â  Â  <FormularioAfiliacion />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <CustomAlertÂ 
Â  Â  Â  Â  Â  Â  Â  Â  open={modalOpen}
Â  Â  Â  Â  Â  Â  Â  Â  onClose={() => setModalOpen(false)}
Â  Â  Â  Â  Â  Â  Â  Â  type="success"
Â  Â  Â  Â  Â  Â  Â  Â  message="Â¡Solicitud de afiliaciÃ³n enviada! En breve, JosÃ© RaÃºl o Francisco se pondrÃ¡n en contacto contigo. Gracias por unirte a CCOO."
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </PageLayout>
Â  Â  );
};


// --- COMPONENTE PRINCIPAL DE LA APLICACIÃ“N ---

const App = () => {
Â  const [currentPage, setCurrentPage] = useState('Home');
Â  const [notification, setNotification] = useState({ message: '', type: 'info', open: false });
Â  const { userId, isAuthReady, auth, db } = useFirebaseAuth();

Â  const navigate = (page) => setCurrentPage(page);

Â  const renderPage = () => {
Â  Â  const props = { navigate, userId, isAuthReady, setNotification };

Â  Â  switch (currentPage) {
Â  Â  Â  case 'Nominas':
Â  Â  Â  Â  return <Nominas {...props} />;
Â  Â  Â  case 'Citas':
Â  Â  Â  Â  return <Citas {...props} />; // Ahora es un Componente de FunciÃ³n
Â  Â  Â  case 'Escritos':
Â  Â  Â  Â  return <Escritos {...props} />;
Â  Â  Â  case 'FAQ':
Â  Â  Â  Â  return <FAQ {...props} />;
Â  Â  Â  case 'PRL':
Â  Â  Â  Â  return <PRL {...props} />;
Â  Â  Â  case 'Afiliacion':
Â  Â  Â  Â  return <Afiliacion {...props} />;
Â  Â  Â  case 'Turnos':
Â  Â  Â  Â  return <Turnos {...props} />;
Â  Â  Â  case 'Indemnizaciones':
Â  Â  Â  Â  return <Indemnizaciones {...props} />;
Â  Â  Â  case 'Documental':
Â  Â  Â  Â  return <Documental {...props} />;
Â  Â  Â  case 'Convenio':
Â  Â  Â  Â  return <Convenio {...props} />;
Â  Â  Â  case 'Home':
Â  Â  Â  default:
Â  Â  Â  Â  return <Home {...props} />;
Â  Â  }
Â  };

Â  const navItems = [
Â  Â  { name: 'Inicio', page: 'Home' },
Â  Â  { name: 'Citas', page: 'Citas' },
Â  Â  { name: 'NÃ³minas', page: 'Nominas' },
Â  Â  { name: 'Escritos', page: 'Escritos' },
Â  Â  { name: 'FAQ', page: 'FAQ' },
Â  Â  { name: 'PRL/Acoso', page: 'PRL' },
Â  Â  { name: 'AfiliaciÃ³n', page: 'Afiliacion' },
Â  ];

Â  if (!isAuthReady) {
Â  Â  return <PageLayout title="Cargando Plataforma..." logo={true}><p className="text-center text-lg mt-10">Conectando con el servidor sindical (autenticaciÃ³n)...</p></PageLayout>;
Â  }

Â  return (
Â  Â  <>
Â  Â  Â  <PageLayoutÂ 
Â  Â  Â  Â  title="JosÃ© RaÃºl Siles y Francisco Aguilera | CCOO Vigilantes"
Â  Â  Â  Â  logo={false}
Â  Â  Â  Â  bgColorClass="bg-gray-50"
Â  Â  Â  Â  navigate={navigate}
Â  Â  Â  Â  currentPage={currentPage} // Pasar la pÃ¡gina actual para el botÃ³n de retroceso
Â  Â  Â  Â  actions={
Â  Â  Â  Â  Â  <nav className="flex space-x-2 overflow-x-auto pb-1 -mb-1 lg:w-auto">
Â  Â  Â  Â  Â  Â  {navItems.map(item => (
Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  key={item.page}
Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => navigate(item.page)}
Â  Â  Â  Â  Â  Â  Â  Â  className={`px-3 py-1.5 rounded-xl font-semibold transition-colors text-sm shadow-md flex-shrink-0 ${currentPage === item.page ? 'bg-red-700 text-white ring-2 ring-red-900' : 'bg-white text-gray-700 hover:bg-gray-100'}`}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  {item.name}
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  }
Â  Â  Â  >
Â  Â  Â  Â  {renderPage()}
Â  Â  Â  </PageLayout>
Â  Â  Â  <CustomAlertÂ 
Â  Â  Â  Â  open={notification.open}
Â  Â  Â  Â  message={notification.message}
Â  Â  Â  Â  type={notification.type}
Â  Â  Â  Â  onClose={() => setNotification({ ...notification, open: false })}
Â  Â  Â  />
Â  Â  </>
Â  );
};

// Renderizar la aplicaciÃ³n
// CRÃTICO: Asegurarse de que el renderizado se haga con la API moderna de React 18
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

Â  Â  </script>
</body>
</html>
